<?xml version="1.0" encoding="UTF-8" ?>

<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
   
      <title>marcin-chwedczuk.github.io/</title>
   
   <link>http://localhost:4000</link>
   <description>A place where I share my thoughts about programming.</description>
   <language>en-uk</language>
   <managingEditor> </managingEditor>
   <atom:link href="rss" rel="self" type="application/rss+xml" />
   
	<item>
	  <title>Passing functions as arguments in Scala. What can go wrong?</title>
	  <link>//passing-functions-as-arguments-in-scala-what-can-go-wrong</link>
	  <author></author>
	  <pubDate>2020-09-11T02:00:01+02:00</pubDate>
	  <guid>//passing-functions-as-arguments-in-scala-what-can-go-wrong</guid>
	  <description><![CDATA[
	     <p>In microservices architecture we often designate a single service for managing the configuration of the entire system.
Libraries like <a href="https://github.com/Netflix/archaius">Archaius</a> make this easy. 
As a side effect, on the code level I often see class declarations like this:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">class</span> <span class="nc">MyService</span><span class="o">(</span><span class="n">timeoutProperty</span><span class="k">:</span> <span class="o">()</span> <span class="o">=&gt;</span> <span class="nc">Long</span><span class="o">)</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span></code></pre></figure>

<p>Basically we inject providers for current configuration properties values into classes.
This has two advantages. First, our classes are independent of any library that we are using
for managing configuration. And second, our classes are easy to test - no mocks needed.</p>

<p>Yet this approach can lead to subtle bugs. Say our original code that creates <code class="highlighter-rouge">MyService</code>
looks like this:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">new</span> <span class="nc">MyService</span><span class="o">(()</span> <span class="k">=&gt;</span> <span class="n">currentTimeoutValue</span><span class="o">())</span></code></pre></figure>

<p>Imagine that a few weeks later a Scala purist is coming by and decides to “improve” this code into:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">new</span> <span class="nc">MyService</span><span class="o">(</span><span class="n">currentTimeoutValue</span><span class="o">)</span></code></pre></figure>

<p>Shorter code, better code as they say…
A few more weeks pass by and we realise that using <code class="highlighter-rouge">Long</code>s for storing time intervals is passé.
So now we are slowly migrating our <code class="highlighter-rouge">() =&gt; Long</code> providers into <code class="highlighter-rouge">() =&gt; java.time.Duration</code>.
Of course as Scala fanboys we decided to add an extension method to <code class="highlighter-rouge">Long</code>, to make the entire
process less painful:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">implicit</span> <span class="k">class</span> <span class="nc">MyRichLong</span><span class="o">(</span><span class="n">l</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">asMillisecondsDuration</span><span class="o">()</span><span class="k">:</span> <span class="kt">Duration</span> <span class="o">=</span> <span class="o">{</span>
    <span class="nc">Duration</span><span class="o">.</span><span class="n">ofMillis</span><span class="o">(</span><span class="n">l</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>In meantime, the code responsible for <code class="highlighter-rouge">MyService</code> creation morphed into:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">class</span> <span class="nc">MyServiceRefactored</span><span class="o">(</span><span class="n">timeoutProperty</span><span class="k">:</span> <span class="o">()</span> <span class="o">=&gt;</span> <span class="nc">Duration</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>

<span class="k">new</span> <span class="nc">MyServiceRefactored</span><span class="o">(</span><span class="n">currentTimeoutValue</span><span class="o">().</span><span class="n">asMillisecondsDuration</span><span class="o">)</span></code></pre></figure>

<p>And… BOOM! It’s no longer working!</p>

<p>Why this code is no longer working? Because</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">new</span> <span class="nc">MyServiceRefactored</span><span class="o">(</span><span class="n">currentTimeoutValue</span><span class="o">().</span><span class="n">asMillisecondsDuration</span><span class="o">)</span></code></pre></figure>

<p>is transformed by Scala compiler into</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">tmp</span> <span class="k">=</span> <span class="n">currentTimeoutValue</span><span class="o">()</span>
<span class="k">new</span> <span class="nc">MyServiceRefactored</span><span class="o">(()</span> <span class="k">=&gt;</span> <span class="n">tmp</span><span class="o">.</span><span class="n">asMillisecondsDuration</span><span class="o">())</span></code></pre></figure>

<p>So <code class="highlighter-rouge">timeout</code> property value is frozen at the moment of <code class="highlighter-rouge">MyServiceRefactored</code> object creation,
this is not what we want.</p>

<p>Bugs like this are hard to figure out. At the first glance everything works fine.
The problem demonstrates itself only when we try to adjust the property value at runtime.
And even then a simple service restart will reload the property, so we may incorrectly assign
it to a configuration server/library/networking glitch.</p>

<p>Here I must mention that this bug was possible only because we broken one of Scala’s good practices.
Our extension method is declared like so</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">def</span> <span class="n">asMillisecondsDuration</span><span class="o">()</span><span class="k">:</span> <span class="kt">Duration</span></code></pre></figure>

<p>but we should be declared like this</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">def</span> <span class="n">asMillisecondsDuration</span><span class="k">:</span> <span class="kt">Duration</span></code></pre></figure>

<p>as this method is actually a getter - it does not mutate the object on which it is called.
If we use the second declaration our bug would be quickly detected by Scala compiler.</p>

<p>In practice a lot of Scala programmers are confused by the optional parentheses
in parameterless method declarations. I often see methods declared like <code class="highlighter-rouge">def foo: Unit</code>
that mutate the state or method declared like <code class="highlighter-rouge">def bar(): Int</code> that are just getters.
For people like me, that constantly switch between Java and Scala, this is especially difficult
and I routinely make mistakes like this (I add parentheses everywhere)…</p>

<p>One solution that people often come up with when confronted with this problem is to
replace functions by by-name parameters.</p>

<p>By-name parameters are nothing new. They where first introduced more than 50 years ago in a language called
Algol60. Early programmers of that language quickly found out that by-name parameters are error prone and difficult to use.
As a result most of the contemporary programming languages do not support them.</p>

<p>Scala as <del>an over-engineered</del> a versatile language supports by-name parameters, as they allow programmers
to create functions that mimic the language build-in constructs. For example:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">def</span> <span class="n">repeat</span><span class="o">(</span><span class="n">times</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)(</span><span class="n">f</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="nc">Unit</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">for</span> <span class="o">(</span><span class="k">_</span> <span class="k">&lt;-</span> <span class="mi">1</span> <span class="n">to</span> <span class="n">times</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">f</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="n">repeat</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">println</span><span class="o">(</span><span class="s">"hurray!"</span><span class="o">)</span>
<span class="o">}</span></code></pre></figure>

<p>The main problem with by-name parameters is that they do not follow the
usual order of evaluation. An ordinary function call</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">egg</span><span class="o">(</span><span class="n">foo</span><span class="o">()),</span> <span class="n">bar</span><span class="o">())</span></code></pre></figure>

<p>will result in functions <code class="highlighter-rouge">foo</code> and <code class="highlighter-rouge">bar</code> being called one after another,
followed by <code class="highlighter-rouge">egg</code> function call.
When we use by-name parameters no order is guaranteed, <code class="highlighter-rouge">foo</code> may be called
before or after <code class="highlighter-rouge">bar</code> or may not be called at all, 
or may be called three times, or four…
This makes code difficult to reason about.
That is why I use by-name parameters sparingly, usually only when I need to implement a
new statement like construct.</p>

<p>That being said, we may declare our new version of <code class="highlighter-rouge">MyService</code> as</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">class</span> <span class="nc">MyService</span><span class="o">(</span><span class="n">timeoutProperty</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="nc">Duration</span><span class="o">)</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span></code></pre></figure>

<p>and it will work flawlessly with our converted-on-the-fly property:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">new</span> <span class="nc">MyService</span><span class="o">(</span><span class="n">currentTimeoutValue</span><span class="o">().</span><span class="n">asMillisecondsDuration</span><span class="o">())</span></code></pre></figure>

<p>To make it clear that we are passing not a value but an expression to be evaluated
(called a <a href="https://en.wikipedia.org/wiki/Thunk">thunk</a>), 
we can surround the expression with curly braces:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">new</span> <span class="nc">MyService</span><span class="o">({</span> <span class="n">currentTimeoutValue</span><span class="o">().</span><span class="n">asMillisecondsDuration</span><span class="o">()</span> <span class="o">})</span></code></pre></figure>

<p>But it must be noted that in Scala we can add curly braces to almost anything, 
e.g. <code class="highlighter-rouge">println({1} + {2})</code>.
In other words curly braces around thunks are only a convention not enforced by the compiler.</p>

<p>Sometimes the best solution is the object-oriented one. So after being disappointed with by-name
params I decided to create an interface:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="nd">@FunctionalInterface</span>
<span class="k">trait</span> <span class="nc">Property</span><span class="o">[</span><span class="kt">V</span><span class="o">]</span> <span class="o">{</span>
  <span class="c1">// parentheses required for lambda -&gt; SAM conversion
</span>  <span class="c1">// in Scala 2.13. Yeah this sucks!
</span>  <span class="k">def</span> <span class="n">value</span><span class="o">()</span><span class="k">:</span> <span class="kt">V</span>
<span class="o">}</span></code></pre></figure>

<p>and inject it into <code class="highlighter-rouge">MyService</code>:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">class</span> <span class="nc">MyService</span><span class="o">(</span><span class="n">timeoutProperty</span><span class="k">:</span> <span class="kt">Property</span><span class="o">[</span><span class="kt">Duration</span><span class="o">])</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span></code></pre></figure>

<p>Scala since version 2.12 supports converting lambda expressions to SAMs (Single Method Interfaces),
so we can create <code class="highlighter-rouge">MyService</code> without too much ceremony:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">new</span> <span class="nc">MyService</span><span class="o">(()</span> <span class="k">=&gt;</span> <span class="n">currentTimeoutValue</span><span class="o">().</span><span class="n">asMillisecondsDuration</span><span class="o">())</span></code></pre></figure>

<p>No simplification is possible this time, and both below examples do not compile:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">new</span> <span class="nc">MyService</span><span class="o">({</span> <span class="n">currentTimeoutValue</span><span class="o">().</span><span class="n">asMillisecondsDuration</span> <span class="o">})</span>
<span class="k">new</span> <span class="nc">MyService</span><span class="o">(</span><span class="n">currentTimeoutValue</span><span class="o">().</span><span class="n">asMillisecondsDuration</span><span class="o">)</span></code></pre></figure>

<p>The protection is, unfortunately, not 100% bullet proof.
For example the following code snipped will compile but does not work as intended:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">new</span> <span class="nc">MyService</span><span class="o">(</span><span class="n">currentTimeoutValue</span><span class="o">().</span><span class="n">asMillisecondsDuration</span> <span class="k">_</span><span class="o">)</span></code></pre></figure>

<p>At least it provides a visual clue (<code class="highlighter-rouge">_</code>) that will attract reviewer attention during the code review.</p>

<p>Now I fully understand why Java designers decided to introduce a new operator <code class="highlighter-rouge">::</code> for creating method
references. It makes it clear which part of the expression will be evaluated only once and which part
will become the functional interface implementation:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">public</span> <span class="n">static</span> <span class="n">void</span> <span class="n">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
  <span class="n">print</span><span class="o">(</span><span class="n">next</span><span class="o">()::</span><span class="n">toString</span><span class="o">);</span>
  <span class="n">print</span><span class="o">(</span><span class="n">next</span><span class="o">().</span><span class="n">toString</span><span class="o">()::</span><span class="n">toUpperCase</span><span class="o">);</span>
  <span class="n">print</span><span class="o">(</span><span class="n">next</span><span class="o">().</span><span class="n">toString</span><span class="o">().</span><span class="n">toUpperCase</span><span class="o">()::</span><span class="n">trim</span><span class="o">);</span>
  
  <span class="n">print</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">next</span><span class="o">().</span><span class="n">toString</span><span class="o">());</span>
<span class="o">}</span></code></pre></figure>

<p>Compare this with Scala:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
  <span class="n">print</span><span class="o">(</span><span class="n">next</span><span class="o">().</span><span class="n">toString</span><span class="o">)</span>
  <span class="n">print</span><span class="o">(</span><span class="n">next</span><span class="o">().</span><span class="n">toString</span><span class="o">.</span><span class="n">toUpperCase</span><span class="o">)</span>
  <span class="n">print</span><span class="o">(</span><span class="n">next</span><span class="o">().</span><span class="n">toString</span><span class="o">.</span><span class="n">toUpperCase</span><span class="o">.</span><span class="n">trim</span><span class="o">)</span>
<span class="o">}</span></code></pre></figure>

<p>Looks likes the third solution is the best one. The only thing left is to provide a fake
implementation for <code class="highlighter-rouge">Property[V]</code> interface to make testing easy:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">class</span> <span class="nc">ManuallySetProperty</span><span class="o">[</span><span class="kt">V</span><span class="o">](</span><span class="n">initialValue</span><span class="k">:</span> <span class="kt">V</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Property</span><span class="o">[</span><span class="kt">V</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">private</span> <span class="k">var</span> <span class="n">v</span> <span class="k">=</span> <span class="n">initialValue</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">value</span><span class="o">()</span><span class="k">:</span> <span class="kt">V</span> <span class="o">=</span> <span class="n">v</span>
  <span class="k">def</span> <span class="n">setValue</span><span class="o">(</span><span class="n">newValue</span><span class="k">:</span> <span class="kt">V</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="n">v</span> <span class="k">=</span> <span class="n">newValue</span>
  <span class="o">}</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">toString</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="o">{</span>
    <span class="n">s</span><span class="s">"property(value=$v)"</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="k">val</span> <span class="n">timeout</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ManuallySetProperty</span><span class="o">(</span><span class="nc">Duration</span><span class="o">.</span><span class="nc">ZERO</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="n">timeout</span><span class="o">.</span><span class="n">value</span><span class="o">())</span>
<span class="n">timeout</span><span class="o">.</span><span class="n">setValue</span><span class="o">(</span><span class="nc">Duration</span><span class="o">.</span><span class="n">ofMinutes</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span>
<span class="n">println</span><span class="o">(</span><span class="n">timeout</span><span class="o">.</span><span class="n">value</span><span class="o">())</span></code></pre></figure>

	  ]]></description>
	</item>

	<item>
	  <title>Devoxx Poland 2018</title>
	  <link>//devoxx-poland-2018</link>
	  <author></author>
	  <pubDate>2018-06-25T02:00:00+02:00</pubDate>
	  <guid>//devoxx-poland-2018</guid>
	  <description><![CDATA[
	     <p>[Photo above shows Mr. Jakub Nabrdalik during his presentation about TDD 
in main conference room.]</p>

<h3 id="about-conference">About conference</h3>

<p>Thanks to my employer <a href="https://cybervadis.com/">CyberVadis</a> I was able to
attend Devoxx Poland 2018 conference. The conference took place in
Cracow (Poland) and lasted three days (20 - 22 June).</p>

<p>Overall my experience with the conference was very good.
Things that I particularly liked were: good coffee, tasty muffins and
beautiful and very comfortable venue (<a href="http://www.icekrakow.pl/">Cracow ICE</a>).</p>

<p>Things that organisers could have done better: on the first day of the 
conference it was difficult to find the right rooms (especially room no. 5). 
Rooms should be marked in a more outstanding way. Quality of
food served during lunches was
only mediocre, I expected something better. Conference offered a lot of
presentation still the number of presentation on advanced topics were limited.
I expected to see more advanced stuff there.</p>

<p>Conference keynote presentation was amazing. 
The speaker Mr. Brian Christian told us about application of
theoretical computer science stuff to everyday problems.
Presentation was based on Mr. Brian book 
<a href="http://a.co/dYsQtCb">Algorithms to Live By</a>.
I already ordered my own copy ;)</p>

<h3 id="my-notes-from-presentations">My notes from presentations</h3>

<p>Below you can find digitalized version of my notes that I took during
presentations. Remember that they are my <strong>personal</strong> notes mostly created for
my colleagues that couldn’t attend the conference. Use them at your own risk.</p>

<h4 id="state-or-events-which-shall-i-keep-by-jakub-pilimon">State or events? Which shall I keep? by Jakub Pilimon</h4>

<ul>
  <li>You can find most of the topics addressed by Mr. Jakub in his blog
 post 
 <a href="https://spring.io/blog/2018/04/11/event-storming-and-spring-with-a-splash-of-ddd">Event Storming and Spring with a Splash of DDD</a>.</li>
  <li>ORM’s can introduce 
 <a href="https://en.wikipedia.org/wiki/No_Silver_Bullet">accidental complexity</a> into
 our applications. Example: loading a list of child
 objects when we only need
 to check number of objects (we are just calling <code class="highlighter-rouge">.size()</code> on the list)
 can cause performance bottlenecks when we are using ORM to persist
 our aggregates.</li>
  <li>Persisting aggregate state as a list of events is not only simpler
 but also much more aligned with DDD design.</li>
  <li>You should prefer returning domain events from aggregate instead of
 publishing them (no more <code class="highlighter-rouge">EventPublisher</code>s in aggregates). For example:</li>
</ul>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyAggregate</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">DomainEvent</span><span class="o">&gt;</span> <span class="n">pendingEvents</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">DomainEvent</span><span class="o">&gt;</span> <span class="nf">getPendingEvents</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">pendingEvents</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">flushEvents</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">pendingEvents</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="nf">performOperation</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// do some stuff</span>
        <span class="n">NameChangedEvent</span> <span class="n">event</span> <span class="o">=</span> 
           <span class="k">new</span> <span class="nf">NameChangedEvent</span><span class="o">(</span><span class="s">"old-name"</span><span class="o">,</span> <span class="s">"new-name"</span><span class="o">);</span>

        <span class="n">pendingEvents</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
        <span class="n">applyEvent</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">// ...</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyAggregateRepository</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">MyAggregate</span> <span class="nf">load</span><span class="o">(</span><span class="n">UUID</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">DomainEvents</span><span class="o">&gt;</span> <span class="n">events</span> <span class="o">=</span> <span class="n">eventStore</span><span class="o">.</span><span class="na">loadEventsById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="n">MyAggregate</span> <span class="n">aggr</span> <span class="o">=</span> <span class="n">MyAggregate</span><span class="o">.</span><span class="na">recreateFrom</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">events</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">aggr</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">MyAggregate</span> <span class="n">aggr</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">eventStore</span><span class="o">.</span><span class="na">appendEvents</span><span class="o">(</span><span class="n">aggr</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">aggr</span><span class="o">.</span><span class="na">getPendingEvents</span><span class="o">());</span>
        <span class="n">aggr</span><span class="o">.</span><span class="na">flushEvents</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// later usage:</span>
<span class="n">var</span> <span class="n">aggr</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
<span class="n">aggr</span><span class="o">.</span><span class="na">performOperation</span><span class="o">();</span>
<span class="n">repo</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">aggr</span><span class="o">);</span></code></pre></figure>

<p>This method of returning events from aggregate root is nothing new.
Variations of this approach appeared as early as in 2013, <a href="https://blog.jayway.com/2013/06/20/dont-publish-domain-events-return-them/">for example here</a>.</p>

<ul>
  <li>
    <p>(My question after talk) You should not confuse domain events used
 to store aggregate state from integration events. Generally it is a
 bad practice to publish to other systems events used to persist aggregate.
 Mostly because you may expose state that should be private to aggregate.</p>
  </li>
  <li>
    <p>(My question after talk) How to deal with GDPR when using immutable
 event store? You should try to keep sensitive data outside of domain events.
 Later I checked that this approach was described <a href="https://twitter.com/mathiasverraes/status/927484596396199937?lang=en">here</a>.</p>
  </li>
</ul>

<p>As an alternative approach you may use encryption as described <a href="https://www.michielrook.nl/2017/11/forget-me-please-event-sourcing-gdpr/">here</a>.
But for some reason I find this solution ugly.</p>

<ul>
  <li>(Someone else’s question) It is fine to use SQL databases to store domain events (at least at the
 beginning). So if you want to start your adventure with event sourcing
 use your old tried SQL db!</li>
</ul>

<p>Overall it was a good presentation but mostly directed at the
beginners.</p>

<p>You can find Jakub Pilimon blog and twitter here:</p>

<ul>
  <li><a href="https://pillopl.github.io/">Blog</a></li>
  <li><a href="https://twitter.com/JakubPilimon">Twitter</a></li>
</ul>

<h4 id="from-availability-and-reliability-to-chaos-engineering-why-breaking-things-should-be-practised-by-adrian-hornsby">From availability and reliability to chaos engineering. Why breaking things should be practised by Adrian Hornsby</h4>

<ul>
  <li>Jesse Robbins is one of the fathers of Chaos Engineering 
 (see <a href="https://www.youtube.com/watch?v=zoz0ZjfrQ9s">this</a> video from 2011).</li>
  <li>Generally we break things in production to build confidence that
 we can quickly fix real problems.</li>
</ul>

<p>Introducing Chaos Engineering into organisation:</p>

<ul>
  <li>Start small. Only break things in production that you are sure are 
 able to survive your “experiments”.</li>
  <li>First make your application resilient then test that resiliency.
 Do NOT do Chaos Engineering experiments in production that you are sure
 will kill your app.</li>
  <li>Test not only infrastructure but also people. If say Bob
 solves 90% of problems on production, check what will happen if other
 team members must solve such problems without Bob.</li>
</ul>

<p>My note: I cannot resist myself from calling this technique a “bus monkey”.</p>

<ul>
  <li>Remember: <strong>Chaos doesn’t cause problems it reveals them</strong></li>
  <li>Areas to test: people, applications, network and data, infrastructure</li>
</ul>

<p>Increasing resiliency:</p>

<ul>
  <li>Availability is measured in “nines”, e.g. four nines is 99.99%, 
 six nines is 99.9999% of time on which application works.</li>
  <li>four-nines is an industry standard (as of 2018)</li>
  <li>Easiest way to increase availability is to create multiple copies of
 the least reliable resources. If for example you have a single 
 server that has 90% of 
 availability, having two such servers working in parallel 
 will create a system with availability of 99%.</li>
  <li>When you are hosting your apps in the cloud remember to use multiple 
 availability zones (AWS lingo).</li>
  <li>Use auto-scaling.</li>
  <li>Follow infrastructure as code approach to achieve testable infrastructure.</li>
  <li>Your infrastructure should be immutable. Never update servers always
 create new instances and remove old one.</li>
  <li>Practice rolling deployments. After a fresh deploy of an application
 do NOT kill old servers immediately. Allow them to say for a while as
 a standby - just in case when your new app version will not work they
 will allow you to quickly rollback your changes.</li>
  <li>Never put all your databases on the same server. Use sharding to spread
 data across many databases.</li>
  <li>Prefer messaging to HTTP requests, message queues are more resilient.
 Send commands instead of issuing HTTP requests.</li>
  <li>When using HTTP remember to use circuit breaker library.
 Use exponential backoff algorithm.</li>
  <li>Remember about DNS (DNS failover, smart load balancing).</li>
  <li>Transient state is a state that is constantly changing, like
 webpage view counters or ad clicks counters. Do not put transient 
 state into database, 
 instead use specialized solutions like Redis to keep it.</li>
  <li>Use async UI, do not wait for operation to finish, display notification
 to the user when operation succeeds or fails. See: 
 <a href="https://medium.com/@sophie_paxtonUX/stop-getting-in-my-way-non-blocking-ux-5cbbfe0f0158">Stop Getting In My Way! — Non-blocking UX</a></li>
</ul>

<p>Chaos Engineering in Practice:</p>

<ul>
  <li>Chaos Engineering is like a fire drills. You are doing it so that
 people will be prepared for a real fire and will not panic.</li>
  <li>Without exercises people will get scary when dealing with real issues
 on production.</li>
  <li>How to start? Start by defining <em>steady state</em> of your application.
 In other words define when you assume that your application is working.
 For example when you have an online shop, you may assume that your 
 application is working when people click “Buy” button a certain number of 
 times per hour. This will be a steady state of your application that
 you will monitor during chaos engineering experiments to make sure
 that application is still working.</li>
  <li>Generally you should use business metric to define steady state.
 Measure things that bring you money!</li>
  <li>Define experiments. What if our DB server stops working?
 What if we have a huge spike in traffic?</li>
  <li>Only try to break things that you are 100% sure should not break
 (otherwise make your application resilient first).</li>
  <li>During chaos experiments always have an emergency stop button so that
 you can stop your experiment at any time.</li>
  <li>Start small! (yeah again, looks like this is very important)</li>
  <li>Experiment with canary deployments e.g. run experiments on 1% of total
 traffic</li>
  <li>Quantify results. How much time elapsed from the failure to detection of 
 that failure? How much time did it take to fix it?
 Is our monitoring working properly? Does notification (pager duty) system
 works correctly?</li>
  <li>Never blame a single person, instead concentrate on things that 
 you can improve.</li>
</ul>

<p>General tips:</p>

<ul>
  <li>During post mortems use Rule of 5 Why. 
 Why it broke? Because of X. Why X happened? Because of Y.
 Why Y happened? … (repeat 5 times)</li>
  <li>Be patient.</li>
  <li>Be aware of cultural blocks (especially among business people).
 Generally do not tell business people that you want to 
 break your application.
 Remember chaos reveals problems not causes them.</li>
</ul>

<p>Overall this was a very good presentation with a bit of AWS advertisement.</p>

<p>You can find Adrian Hornsby twitter here:</p>

<ul>
  <li><a href="https://twitter.com/adhorn">Twitter</a></li>
</ul>

<h4 id="through-the-valley-of-darkness-the-road-to-microservices-by-dominik-boszko">Through the valley of darkness, the road to microservices by Dominik Boszko</h4>

<ul>
  <li>Ask yourself if you get any of the benefits that
 microservice architecture promised you.</li>
  <li>Signs that you are working with distributed monolith:
    <ul>
      <li>Change in one microservice propagates to others
e.g. I return additional field from some REST endpoint in service A,
 but may application will start working only when I recompile service B.</li>
      <li>There is too much communication going on between teams.</li>
      <li>Change in service A that is managed by my team requires approval from
some other team</li>
    </ul>
  </li>
  <li>When working with microservices Don’t Repeat Yourself rule is considered
 harmfull. Microservices should be as independent from each other as possible.</li>
  <li>Avoid coupling between microservices. Do NOT create libraries with shared
 REST DTO’s or events that will be used by many services.
 Instead introduce contracts (use tools like Swagger). 
 Each service should contain it’s own copy of consumed DTO’s and events.
 These DTO’s should contain only the fields that the service needs.</li>
  <li>Be wary of <code class="highlighter-rouge">Core</code>s, <code class="highlighter-rouge">Platform</code>s, <code class="highlighter-rouge">Common</code>s etc. libraries that are used
 by every microservice. Microservices should be independent of each other.
 In the best case scenario you will only share security and logging related code.</li>
  <li>Shared libraries are bad because of transitive dependencies.
 For example team A adds a dependency on SuperXmlParser-v2.0 to the core library.
 This breaks service B maintained by team B that is using SuperXmlParser-v1.0 library.</li>
  <li>When using microservice architecture role of software architect changes.
 Architect no longer can enforce his decisions on teams. Instead teams are
 self organizing and cross functional and they ultimately decide on the design 
 and architecture of the services that they own.</li>
  <li>Software architect should concentrate on high level concerns like security,
 integration with other applications and best practices. Think BIG PICTURE!</li>
  <li>Software architects should strive to avoid micromanagement (especially when they
 have only experience with monolithic application development).</li>
  <li>Do not be afraid to use different technologies and architectural styles for
 different microservices (this is one of the selling points of the
 microservice architecture after all).</li>
  <li>Teams should be aligned with bounded context. Teams should have a deep
 knowledge of their domains. Therefore teams are best equipped to make
 architectural decisions. This is the best usage of the top talent that
 you have hired.</li>
  <li>Avoid nanoservices (service that does the job of a single method).</li>
  <li>Do not rush into microservices. Think if you really needs benefits that
 this approach can offer you. Keep in mind additional complexity that
 comes with this approach.</li>
</ul>

<p>This was one of the best presentations that I have seen on Devoxx.
It was based on personal experiences of Mr. Dominik. Good Job!</p>

<h4 id="how-to-impress-your-boss-and-your-customer-in-a-modern-software-development-company-by-wojciech-seliga">How to impress your boss and your customer in a modern software development company by Wojciech Seliga</h4>

<ul>
  <li>Modern software house is decentralized. People communicate with each other.
 Programmers talk to the client. Client can decide whom you should give a rise!</li>
  <li>A few more attributes of modern software company: short feedback loops,
 constant improvement (thank to feedback), autonomous teams, decentralized
 decision making, individual impact (every one feels that his job is important
 and that this person contributes significantly to the success of company).</li>
  <li>In other words: Customer becomes the new boss.</li>
  <li>How to impress your new boss? Deliver great stuff!</li>
  <li>Check out <a href="http://a.co/93Pp6BM">How Google Works</a> book.
 It uses term <em>Smart creatives</em> to define modern knowledge workers.
 Smart creatives are not only tech but also business savvy.
 They are open, passionate persons that strive to learn something new
 every day. (My note: this sounds like some old school hackers to me).</li>
  <li>Smart creatives like to work on interesting problems.
 They also like to work with interesting people. They often
 have interesting and colorful lives.</li>
  <li>Negativity destroys people. It also destroys people’s brains - so please
 don’t be negative.</li>
  <li>Check out <a href="https://pragprog.com/book/ahptl/pragmatic-thinking-and-learning">Pragmatic Thinking and Learning</a> book</li>
  <li>(My note: more motivational $#@!, I have nothing against it but I think this is
 not based on any scientific studies. It is just pop-psychology stuff 
 so believe it or not). Success is 10% talent, 90% hard work.
 Hard work beats talent when talent fails to work hard.</li>
  <li>Anyone who stops learning is already OLD (my note: I should better learn something
 from this presentation).</li>
  <li>Growth mindset. Prise for effort not for results (my note: more pop-psychology).</li>
</ul>

<p>Questions for job interview that can test if person has growth mindset
and is a good candidate to become smart creative:</p>

<ul>
  <li>What have you learned in your current job?</li>
  <li>How do you decide what to learn?</li>
  <li>What did you learn last month?</li>
  <li>What do you do to stay up to date with tech?</li>
  <li>What trends in technology did you miss?</li>
  <li>What challenges do you expect at your new job?</li>
  <li>How do you measure yourself and your progress?</li>
</ul>

<p>Who is a senior developer?</p>

<ul>
  <li>Primary role of a senior developer is to teach and mentor others.</li>
  <li>Senior developer should be a great example to others.</li>
  <li>Seniors should strive to build better environment for developers
 (no blaming each other, better dev processes, better and more friendly
code review etc.)</li>
  <li>Being a senior developer is not about doing the same things as mid but
 faster.</li>
</ul>

<p>More job interview questions:</p>

<ul>
  <li>What could you teach me in 5 minutes?</li>
  <li>What do you do now differently than in the last 5 years?</li>
  <li>How did you impact other people?</li>
</ul>

<p>Back to main topic again:</p>

<ul>
  <li>Be the weakest person in the room (so that you will learn quickly).</li>
  <li>Being the best person in the room is bad for your professional development.
 You may not learn as much as you can.</li>
  <li>1 year in a fast-paced environment is often better than 5+ years of experience
 in an average company.</li>
</ul>

<p>More job interview questions:</p>

<ul>
  <li>What is your best professional achievement?</li>
  <li>What is your top strength?</li>
  <li>What is your weakest point as a professional software developer?</li>
  <li>What are you doing about it?</li>
  <li>Why did you choose software development as your career?</li>
  <li>What are you passionate about?</li>
</ul>

<p>Back to main topic again:</p>

<ul>
  <li>Developers should be ready to take responsibility for the product they build.</li>
  <li>Developers that are already responsible may take ownership of their product.</li>
  <li>Passion is very important for smart creatives. Passion gives you intrinsic 
 motivation. Curiosity will force you to learn new things. Desire to change
 the words will make it happen.</li>
  <li>Modern software house is sliced vertically. Every team owns parts of the product
 and can do support, maintenance and  development. 
 Also each team can talk directly with the client and make it’s own
 decisions.</li>
</ul>

<p>Overall it was an interesting and good presentation but I have a feeling
that I just missed the point.</p>

<p>Mr. Wojciech <a href="https://twitter.com/wseliga?lang=en">Twitter</a>.</p>

<h4 id="docs-in-the-self-documenting-world-by-wojtek-erbetowski">Docs in the self-documenting world by Wojtek Erbetowski</h4>

<p>(my note: I was late so I missed a lot of interesting stuff here)</p>

<ul>
  <li>Apply UX techniques like <a href="https://en.wikipedia.org/wiki/Persona_(user_experience)">personas</a> and <a href="https://boagworld.com/usability/customer-journey-mapping/">user journey mapping</a> to the documentation.</li>
  <li>Do not put code snippets into documentation. Instead link to a real 
 test or program source code. Especially linking to tests source code is
 advised, this way documentation will always will be up to date.</li>
  <li>A lot of tools like <a href="http://mrhaki.blogspot.com/2014/04/awesome-asciidoc-include-partial-parts.html">AsciiDoc</a> can already do this.</li>
  <li>Writing a documentation should be a pleasure for developers.</li>
  <li>Example: library of React components was created as a React application.
 For each component a short description, real working component, example source code
 usage and a list of available properties is displayed.</li>
  <li>This library is actually generated for the source code of the components. 
 So it doesn’t need to be maintained by developers and stays always up to date.</li>
  <li>Always think for whom you are creating the documentation.</li>
</ul>

<h4 id="improving-your-test-driven-development-in-45-minutes-by-jakub-nabrdalik">Improving your Test Driven Development in 45 minutes by Jakub Nabrdalik</h4>

<ul>
  <li>Interesting article <a href="https://codurance.com/2015/05/12/does-tdd-lead-to-good-design/">Does TDD really lead to good design?</a></li>
</ul>

<p>Common problems with tests:</p>

<ul>
  <li>Too low level tests:
    <ul>
      <li>We have test for every single class in our project.</li>
      <li>Tests knows too much about code that they are testing.
Even minor refactorings of class API result in broken tests.</li>
    </ul>
  </li>
  <li>Too high level tests:
    <ul>
      <li>We only have integration tests.</li>
      <li>Tests are slow. Generally speaking integration tests that use even in memory
DB like H2 are too slow for TDD cycle (people are losing flow).</li>
    </ul>
  </li>
  <li>To have effective TDD cycle we should been able 
 to run a single unit test in less than 1 second.</li>
</ul>

<p>The solution:</p>

<ul>
  <li>Group your code into modules. Module API changes more slowly than
 class API. Test only module public API.</li>
  <li>A single module contains all application layers e.g. REST controllers,
 services, command handlers, repositories, database access etc.
 In other words modules are vertical slices of functionality.</li>
  <li>Module should be like a microservice.</li>
  <li>Integration tests are slow. Use integration tests only to test
 crucial paths through your application. Tests things that bring you
 money.</li>
  <li>It is OK to have many assertions in a single integration test.</li>
  <li>Module should expose a <code class="highlighter-rouge">ModuleConfiguration</code> class that can create a
 ready to use module that uses fakes to interact with other modules and IO.</li>
  <li>Prefer fakes to mocks and stubs. Use in memory repositories. Avoid doing IO
 at all costs in unit tests.</li>
  <li>Test only behaviour of the module using its public API.</li>
  <li>Use mocks only for interaction with other modules.</li>
  <li>Checkout this repo <a href="https://github.com/olivergierke/sos">https://github.com/olivergierke/sos</a></li>
</ul>

<p>Towards better tests:</p>

<ul>
  <li>Use business names (ubiquitous language) in the tests (and tests names too).</li>
  <li>Hide unnecessary information from test code (you should only show information
 that are relevant for this particular test).</li>
  <li>For each module create utility classes that provide real-like test data.</li>
  <li>Create a DSL for your tests.</li>
  <li>Prefer code to frameworks like Cucumber (business people don’t use it anyway).</li>
  <li>Spock is a very good testing framework for Java.</li>
  <li>You may use shared immutable (read only) DB with test data to test 
 e.g. repositories - this way you can speed up your integration tests.</li>
</ul>

<p>Mr. Jakub Nabrdalik twitter and blog:</p>

<ul>
  <li><a href="https://twitter.com/jnabrdalik?lang=en">Twitter</a></li>
  <li><a href="http://blog.solidcraft.eu/">Blog</a></li>
</ul>

<p>If you want to learn more about Mr. Jakub way of doing modules
please see his <a href="https://github.com/jakubnabrdalik/hentai">demo project</a> on GitHub.</p>

<h4 id="modules-or-microservices-by-sander-mak">Modules or Microservices? by Sander Mak</h4>

<p>For this presentation I will not provide notes. Instead I am going to 
express my views on arguments used by Mr. Sander.</p>

<p>Mr. Sander believes that developing applications using microservice
architecture is much more difficult than developing a monolithic software.
Also Mr. Sander believes that microservice architecture moves so called
“wall of unmaintainability” further from us (we may add more features to
the application before it becomes unmaintainable in therms of cost).
I fully agree with these both statements.</p>

<p>Now the things that I disagree with. Mr. Sander proposes a modular architecture
(monolith split into modules) as a silver bullet that will allow us to reap
most of the benefits of microservices will still preserving simplicity of
development. Unfortunately in his presentation some disadvantages of this
approach were not mentioned, like:</p>

<ul>
  <li>Slow build and testing. Slow deploy. (It is still a monolith just with a better
 code organization.)</li>
  <li>A minor error in a single unimportant module 
 can break entire application.
 For example large numbers of unclosed files,
 memory leaks or stackoverflow exceptions can break (depending
 on used tech stack) even entire application.</li>
  <li>Implicit shared state between modules like current working directory, PID etc.</li>
  <li>A modular application will usually use single database technology and
 a single database server (possibly with read replicas). 
 As writes will be server by a single server instance this may cause 
 severe performance problems in the future.</li>
  <li>Entire application must be written in the same technology (JVM, .NET, node.js).</li>
  <li>Usually in monolithic applications people have a kind of Core or Platform 
 (or Commons or whatever) library that contains utils and shared components.
 This kind of libraries have a tendency to grow uncontrollably 
 and over time they become difficult to change
 (because any change to them requires a lot of refactoring in several modules).
 Also quality of these libraries is often substandard (they are usually not actively
 maintained after they provide functionality needed by their authors - 
 if it works don’t change it approach).</li>
</ul>

<p>I must admit that nowadays it is much more difficult to develop microservices
vs monolith. But I believe this is caused mostly by lack of good 
frameworks and tools. For example I can imagine that in the future
we will have some standard API for logging and monitoring offered by
all relevant cloud providers. From my point of view Spring Boot framework
looks very promising. Also I believe that we have only just started doing 
cloud computing
(it still a very young and immature technology) and we should see a lot of
improvements in the area of distributed system development.</p>

<p>To sum up: using modules is always a good idea. Depending on your
requirements sometimes you will want to build a modular monolith, sometimes
a bunch of microservices. Context is always the king.</p>

<h3 id="buzz">Buzz</h3>

<ul>
  <li>GraphQL</li>
  <li>Chaos Engineering</li>
  <li>A/B Testing</li>
  <li>Canary releases</li>
  <li>Infrastructure as Code</li>
</ul>


	  ]]></description>
	</item>


</channel>
</rss>

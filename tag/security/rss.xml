<?xml version="1.0" encoding="UTF-8" ?>

<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
   
      <title>marcin-chwedczuk.github.io/</title>
   
   <link>https://marcin-chwedczuk.github.io/</link>
   <description>A place where I can share my thoughts about programming</description>
   <language>en-uk</language>
   <managingEditor> marcin-chwedczuk</managingEditor>
   <atom:link href="rss" rel="self" type="application/rss+xml" />
   
	<item>
	  <title>Why using PESEL as a password is a very bad idea</title>
	  <link>//why-using-pesel-as-a-password-is-a-very-bad-idea</link>
	  <author>marcin-chwedczuk</author>
	  <pubDate>2019-02-25T01:00:00+01:00</pubDate>
	  <guid>//why-using-pesel-as-a-password-is-a-very-bad-idea</guid>
	  <description><![CDATA[
	     <p>I am sure, none of you, my dear readers would use a PESEL number
as a password or an encryption key.
Still, as unbelievable as it may sounds, recently 
I was talking with my friend on a topic of computer security and
he told me a horror story about a certain company doing exactly that.
Such practice is highly insecure and in this post I going to
prove that. Namely we will create an encrypted 7zip archive with
a random PESEL as a password and then we will crack it using
<a href="https://github.com/magnumripper/JohnTheRipper">John the Ripper</a>.</p>

<p>DISCLAIMER: All information is provided for educational purposes only.
Accessing data that does not belong to you is in most
cases illegal. Always check your local laws and your company policy
before using tools presented in this blog post.</p>

<h3 id="wtf-is-pesel">WTF is PESEL?</h3>

<p>First, let me explain for non-Polish readers what is
a <a href="https://en.wikipedia.org/wiki/PESEL">PESEL number</a>.
Basically it is an identification number similar to 
US Social Security number (SSN).
Every Polish citizen is assigned one unique PESEL number at birth.</p>

<p>But more important to us here is, that 
PESEL numbers have a very well defined structure:
<img src="assets/images/2019-02-25/pesel.svg" alt="PESEL number structure" />
First six digits of a PESEL number represent a date of birth
in <code class="highlighter-rouge">YYMMDD</code> format. Of course such a simple format does not allow us
to represent birth dates after year 1999. 
So there is a small twist, by adding twenty to the month number
we signify that the year is <code class="highlighter-rouge">20YY</code> not <code class="highlighter-rouge">19YY</code>.
For example if a person was born on 25th March 2029 we encode it
in PESEL as <code class="highlighter-rouge">292325XXXXX</code>.</p>

<p>The other interesting property of a PESEL number is that one before last
digit is used to encode person gender. Males are assigned
only odd digits, females only even digits.</p>

<p>The last digit of a PESEL is a checksum that can be easily computed
using other digits.</p>

<h3 id="so-how-many-pesels-are-there">So how many PESELs are there?</h3>

<p>Let’s assume that we intercepted a message encrypted by a PESEL
number. We know that the recipient of the message is male,
with age between twenty and sixty five.
How much PESELs we must brute force in the worst case scenario?</p>

<figure class="highlight"><pre><code class="language-no-highlight" data-lang="no-highlight">(65 - 20 + 1) * 356 * 10^3 * 5 = 83_950_000</code></pre></figure>

<p>How many six character 
passwords are there consisting of small letters and numbers?</p>

<figure class="highlight"><pre><code class="language-no-highlight" data-lang="no-highlight">(10 + 26)^6 = 2_176_782_336</code></pre></figure>

<p>Do you consider a six character password safe? Of course not!
Yet the number of possible six character passwords dwarfs
the number of possible PESELs.</p>

<p>What is worse, is that it is usually not too difficult to find out person
<em>year</em> of birth, thus reducing number of possible PESELs even more.</p>

<h3 id="demo-time">Demo time</h3>

<p>To demonstrate how weak protection PESEL passwords provide,
we will first create an encrypted <code class="highlighter-rouge">7z</code> archive and then
we will try to crack it using John the Ripper.</p>

<p>All provided instructions are for Ubuntu, but there should
be no problems with running modified versions of
these commands on macOS or Windows.</p>

<p>First we need to install <a href="https://www.7-zip.org/download.html">7-zip</a>:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">sudo apt-get install p7zip-full p7zip-rar</code></pre></figure>

<p>Then we can create an encrypted archive:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">7z a -m0<span class="o">=</span>lzma2 -mx<span class="o">=</span>9 -p29032502498 secret.7z secret.txt </code></pre></figure>

<p>with <code class="highlighter-rouge">29032502498</code> PESEL as a password.</p>

<p>Just to make sure that the archive is indeed encrypted,
we execute:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="gp">$ </span>7z l -slt secret.7z

<span class="o">(</span>... skipped ...<span class="o">)</span>
Encrypted <span class="o">=</span> +
Method <span class="o">=</span> LZMA2:16 7zAES:19
Block <span class="o">=</span> 0</code></pre></figure>

<p><code class="highlighter-rouge">7zAES:19</code> visible in the command output means that the archive 
is encrypted with AES-256 algorithm.</p>

<h3 id="meet-john">Meet John</h3>

<p>To install John the Ripper we must follow instructions
<a href="https://github.com/magnumripper/JohnTheRipper/blob/bleeding-jumbo/doc/INSTALL-UBUNTU">from the official repository</a>.
I compiled John without OpenCL and REXGEN support, YMMV though.</p>

<p>To allow John to crack <code class="highlighter-rouge">7z</code> file, first we must extract a hash from
it:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">./john/run/7z2john.pl secret.7z &gt; secret.7z.hash</code></pre></figure>

<p>To make this Perl script work, I had to install this library:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">sudo apt-get install libcompress-raw-lzma-perl</code></pre></figure>

<p>Then I generated a suitable list of PESEL numbers
(people aged 20-65, males) using
<a href="https://github.com/marcin-chwedczuk/blog-pesel-password-bad-idea/blob/master/peselgen/Program.cs">this short program</a>
that I wrote.
The generated file <code class="highlighter-rouge">pesels.txt</code> is about 1GB big and
consist of 82 185 000 PESEL numbers.
We are going to use it as a John the Ripper wordlist.</p>

<p>Now we can start cracking:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">./john/run/john --wordlist<span class="o">=</span>pesels.txt secret.7z.hash

<span class="c"># Found passwords are saved in john.pot file</span>
cat ./john/run/john.pot</code></pre></figure>

<p>I performed two test. First I tried to crack a small
340B archive that you can find <a href="https://github.com/marcin-chwedczuk/blog-pesel-password-bad-idea/blob/master/secret.7z">here</a>.
On it I achieved speed of about 100 checked PESELs per second,
this means that cracking it, could take in the worst case scenario:</p>

<figure class="highlight"><pre><code class="language-no-highlight" data-lang="no-highlight">82 185 000 / 100 / 3600 / 24 ~ 10 days</code></pre></figure>

<p>And all this on my four years old i7-4771 CPU, using John without GPU support.
Imagine how fast it would work on a high end Amazon EC2 instance…</p>

<p>Then I performed a second test, trying to crack 3MB archive
containing a PDF file. There I achieved speed of about 50 PESELs per second.
Not bad either (20 days in the worst case scenario).</p>

<p>But you don’t have to believe me here. Grab the
<a href="https://github.com/marcin-chwedczuk/blog-pesel-password-bad-idea/blob/master/secret.7z">test archive</a> and try to crack it yourself!
I encrypted it with a random PESEL generated using <a href="https://bogus-z-polska.pl/generatory/all.html">Bogus</a> site. Good luck!</p>

<p>As we can see archives protected by PESEL numbers can be easily cracked.</p>

<h3 id="conclusion">Conclusion</h3>

<ul>
  <li>Do NOT use PESEL numbers neither as passwords nor as encryption keys.</li>
  <li>Do USE <a href="https://www.gnupg.org/">GPG</a> if you want to send other person
 some secret data using email.</li>
</ul>

<h3 id="references">References</h3>

<ul>
  <li><a href="https://askubuntu.com/a/928301">https://askubuntu.com/a/928301</a></li>
  <li><a href="https://sourceforge.net/p/p7zip/patches/25/#3da5">https://sourceforge.net/p/p7zip/patches/25/#3da5</a></li>
  <li><a href="https://github.com/magnumripper/JohnTheRipper/blob/bleeding-jumbo/doc/INSTALL-UBUNTU">https://github.com/magnumripper/JohnTheRipper/blob/bleeding-jumbo/doc/INSTALL-UBUNTU</a></li>
  <li><a href="https://www.openwall.com/john/doc/">https://www.openwall.com/john/doc/</a></li>
  <li><a href="https://github.com/koboi137/john/blob/master/7z2john.pl#L32">https://github.com/koboi137/john/blob/master/7z2john.pl#L32</a></li>
</ul>


	  ]]></description>
	</item>


</channel>
</rss>

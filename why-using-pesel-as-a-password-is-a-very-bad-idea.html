<!DOCTYPE html>
<html>
<head>
    <!-- [[! Document Settings ]] -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- [[! Page Meta ]] -->
    <title>Why using PESEL as a password is a very bad idea</title>
    <meta name="description" content="Programming is Magic - A place where I can share my thoughts about programming" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="/assets/images/favicon.ico" >

    <!-- [[! Styles'n'Scripts ]] -->
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css"
          href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css" />

    <!-- [[! highlight.js ]] -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    

    <!-- [[! Ghost outputs important style and meta data with this tag ]] -->
        <link rel="canonical" href="/" />
    <meta name="referrer" content="origin" />
    <link rel="next" href="/page2/" />

    <meta property="og:site_name" content="Programming is Magic" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Programming is Magic" />
    <meta property="og:description" content="A place where I can share my thoughts about programming" />
    <meta property="og:url" content="/" />
    <meta property="og:image" content="/assets/images/cover1.jpg" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Programming is Magic" />
    <meta name="twitter:description" content="A place where I can share my thoughts about programming" />
    <meta name="twitter:url" content="/" />
    <meta name="twitter:image:src" content="/assets/images/cover1.jpg" />

    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Website",
    "publisher": "Programming is Magic",
    "url": "/",
    "image": "/assets/images/cover1.jpg",
    "description": "A place where I can share my thoughts about programming"
}
    </script>

    <meta name="generator" content="Jekyll 3.0.0" />
    <link rel="alternate" type="application/rss+xml" title="Programming is Magic" href="/feed.xml" />


</head>
<body class="home-template nav-closed">

    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        <li class="nav-home " role="presentation">
            <a href="/">Home</a>
        </li>
        
        <li class="nav-javascript " role="presentation"><a href="/tag/javascript">JavaScript</a></li>
        <li class="nav-speeches " role="presentation"><a href="/tag/java">Java</a></li>

        <li class="nav-fiction " role="presentation"><a href="/tag/csharp">C#</a></li>
        
        <li class="nav-fiction " role="presentation"><a href="/tag/algorithms">Algorithms</a></li>


        <li class="nav-author " role="presentation">
            <a href="/author/mc">Author</a>
        </li>
    </ul>
    <a class="subscribe-button icon-feed" href="/feed.xml">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        <!-- [[! Everything else gets inserted here ]] -->
        <!-- < default -->

<!-- The comment above "< default" means - insert everything in this file into -->
    <!-- the [body] of the default.hbs template, which contains our header/footer. -->

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<header class="main-header post-head  no-gradient" style="background-image: url(/assets/images/mc_cover2.jpg) ">
    <nav class="main-nav  overlay  clearfix">
        <a class="blog-logo" href="/"><img src="/assets/images/home.png" alt="Blog Logo" /></a>
        
            <a class="menu-button icon-menu" href="#"><span class="word">Menu</span></a>
        
    </nav>
</header>

<main class="content" role="main">

    <article class="post tag-test tag-content">

        <header class="post-header">
            <h1 class="post-title">Why using PESEL as a password is a very bad idea</h1>
            <section class="post-meta">
            <!-- <a href='/'>marcin-chwedczuk</a> -->
            <time class="post-date" datetime="2019-02-25">25 Feb 2019</time>
                <!-- [[tags prefix=" on "]] -->
                 
                on 
                
                    
                       <a href='/tag/security'>Security</a>
                       
                
                
            </section>
        </header>

        <section class="post-content">
            
            <p>I am sure, none of you, my dear readers would use a PESEL number
as a password or an encryption key.
Still, as unbelievable as it may sounds, recently 
I was talking with my friend on a topic of computer security and
he told me a horror story about a certain company doing exactly that.
Such practice is highly insecure and in this post I going to
prove that. Namely we will create an encrypted 7zip archive with
a random PESEL as a password and then we will crack it using
<a href="https://github.com/magnumripper/JohnTheRipper">John the Ripper</a>.</p>

<p>DISCLAIMER: All information is provided for educational purposes only.
Accessing data that does not belong to you is in most
cases illegal. Always check your local laws and your company policy
before using tools presented in this blog post.</p>

<h3 id="wtf-is-pesel">WTF is PESEL?</h3>

<p>First, let me explain for non-Polish readers what is
a <a href="https://en.wikipedia.org/wiki/PESEL">PESEL number</a>.
Basically it is an identification number similar to 
US Social Security number (SSN).
Every Polish citizen is assigned one unique PESEL number at birth.</p>

<p>But more important to us here is, that 
PESEL numbers have a very well defined structure:
<img src="assets/images/2019-02-25/pesel.svg" alt="PESEL number structure" />
First six digits of a PESEL number represent a date of birth
in <code class="highlighter-rouge">YYMMDD</code> format. Of course such a simple format does not allow us
to represent birth dates after year 1999. 
So there is a small twist, by adding twenty to the month number
we signify that the year is <code class="highlighter-rouge">20YY</code> not <code class="highlighter-rouge">19YY</code>.
For example if a person was born on 25th March 2029 we encode it
in PESEL as <code class="highlighter-rouge">292325XXXXX</code>.</p>

<p>The other interesting property of a PESEL number is that one before last
digit is used to encode person gender. Males are assigned
only odd digits, females only even digits.</p>

<p>The last digit of a PESEL is a checksum that can be easily computed
using other digits.</p>

<h3 id="so-how-many-pesels-are-there">So how many PESELs are there?</h3>

<p>Let’s assume that we intercepted a message encrypted by a PESEL
number. We know that the recipient of the message is male,
with age between twenty and sixty five.
How much PESELs we must brute force in the worst case scenario?</p>

<figure class="highlight"><pre><code class="language-no-highlight" data-lang="no-highlight">(65 - 20 + 1) * 356 * 10^3 * 5 = 83_950_000</code></pre></figure>

<p>How many six character 
passwords are there consisting of small letters and numbers?</p>

<figure class="highlight"><pre><code class="language-no-highlight" data-lang="no-highlight">(10 + 26)^6 = 2_176_782_336</code></pre></figure>

<p>Do you consider a six character password safe? Of course not!
Yet the number of possible six character passwords dwarfs
the number of possible PESELs.</p>

<p>What is worse, is that it is usually not too difficult to find out person
<em>year</em> of birth, thus reducing number of possible PESELs even more.</p>

<h3 id="demo-time">Demo time</h3>

<p>To demonstrate how weak protection PESEL passwords provide,
we will first create an encrypted <code class="highlighter-rouge">7z</code> archive and then
we will try to crack it using John the Ripper.</p>

<p>All provided instructions are for Ubuntu, but there should
be no problems with running modified versions of
these commands on macOS or Windows.</p>

<p>First we need to install <a href="https://www.7-zip.org/download.html">7-zip</a>:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">sudo apt-get install p7zip-full p7zip-rar</code></pre></figure>

<p>Then we can create an encrypted archive:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">7z a -m0<span class="o">=</span>lzma2 -mx<span class="o">=</span>9 -p29032502498 secret.7z secret.txt </code></pre></figure>

<p>with <code class="highlighter-rouge">29032502498</code> PESEL as a password.</p>

<p>Just to make sure that the archive is indeed encrypted,
we execute:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="gp">$ </span>7z l -slt secret.7z

<span class="o">(</span>... skipped ...<span class="o">)</span>
Encrypted <span class="o">=</span> +
Method <span class="o">=</span> LZMA2:16 7zAES:19
Block <span class="o">=</span> 0</code></pre></figure>

<p><code class="highlighter-rouge">7zAES:19</code> visible in the command output means that the archive 
is encrypted with AES-256 algorithm.</p>

<h3 id="meet-john">Meet John</h3>

<p>To install John the Ripper we must follow instructions
<a href="https://github.com/magnumripper/JohnTheRipper/blob/bleeding-jumbo/doc/INSTALL-UBUNTU">from the official repository</a>.
I compiled John without OpenCL and REXGEN support, YMMV though.</p>

<p>To allow John to crack <code class="highlighter-rouge">7z</code> file, first we must extract a hash from
it:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">./john/run/7z2john.pl secret.7z &gt; secret.7z.hash</code></pre></figure>

<p>To make this Perl script work, I had to install this library:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">sudo apt-get install libcompress-raw-lzma-perl</code></pre></figure>

<p>Then I generated a suitable list of PESEL numbers
(people aged 20-65, males) using
<a href="https://github.com/marcin-chwedczuk/blog-pesel-password-bad-idea/blob/master/peselgen/Program.cs">this short program</a>
that I wrote.
The generated file <code class="highlighter-rouge">pesels.txt</code> is about 1GB big and
consist of 82 185 000 PESEL numbers.
We are going to use it as a John the Ripper wordlist.</p>

<p>Now we can start cracking:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">./john/run/john --wordlist<span class="o">=</span>pesels.txt secret.7z.hash

<span class="c"># Found passwords are saved in john.pot file</span>
cat ./john/run/john.pot</code></pre></figure>

<p>I performed two test. First I tried to crack a small
340B archive that you can find <a href="https://github.com/marcin-chwedczuk/blog-pesel-password-bad-idea/blob/master/secret.7z">here</a>.
On it I achieved speed of about 100 checked PESELs per second,
this means that cracking it, could take in the worst case scenario:</p>

<figure class="highlight"><pre><code class="language-no-highlight" data-lang="no-highlight">82 185 000 / 100 / 3600 / 24 ~ 10 days</code></pre></figure>

<p>And all this on my four years old i7-4771 CPU, using John without GPU support.
Imagine how fast it would work on a high end Amazon EC2 instance…</p>

<p>Then I performed a second test, trying to crack 3MB archive
containing a PDF file. There I achieved speed of about 50 PESELs per second.
Not bad either (20 days in the worst case scenario).</p>

<p>But you don’t have to believe me here. Grab the
<a href="https://github.com/marcin-chwedczuk/blog-pesel-password-bad-idea/blob/master/secret.7z">test archive</a> and try to crack it yourself!
I encrypted it with a random PESEL generated using <a href="https://bogus-z-polska.pl/generatory/all.html">Bogus</a> site. Good luck!</p>

<p>As we can see archives protected by PESEL numbers can be easily cracked.</p>

<h3 id="conclusion">Conclusion</h3>

<ul>
  <li>Do NOT use PESEL numbers neither as passwords nor as encryption keys.</li>
  <li>Do USE <a href="https://www.gnupg.org/">GPG</a> if you want to send other person
 some secret data using email.</li>
</ul>

<h3 id="references">References</h3>

<ul>
  <li><a href="https://askubuntu.com/a/928301">https://askubuntu.com/a/928301</a></li>
  <li><a href="https://sourceforge.net/p/p7zip/patches/25/#3da5">https://sourceforge.net/p/p7zip/patches/25/#3da5</a></li>
  <li><a href="https://github.com/magnumripper/JohnTheRipper/blob/bleeding-jumbo/doc/INSTALL-UBUNTU">https://github.com/magnumripper/JohnTheRipper/blob/bleeding-jumbo/doc/INSTALL-UBUNTU</a></li>
  <li><a href="https://www.openwall.com/john/doc/">https://www.openwall.com/john/doc/</a></li>
  <li><a href="https://github.com/koboi137/john/blob/master/7z2john.pl#L32">https://github.com/koboi137/john/blob/master/7z2john.pl#L32</a></li>
</ul>



        </section>

        <footer class="post-footer">

            <!-- Everything inside the #author tags pulls data from the author -->
            <!-- #author-->

            
            <figure class="author-image">
                <a class="img" href="/author/mc" style="background-image: url(/assets/images/mc.png)"><span class="hidden">'s Picture</span></a>
            </figure>
            

            <section class="author">
                <h4><a href="/author/mc">marcin-chwedczuk</a></h4>
                
                
                    <p> A Programmer, A Geek, A Human</p>
                
                <div class="author-meta">
                    <span class="author-location icon-location"> Warsaw, Poland</span> 
                    <span class="author-link icon-link"><a href="https://marcin-chwedczuk.github.io/"> marcin-chwedczuk.github.io/</a></span> 
                </div>
            </section>

            <!-- /author  -->

            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="http://twitter.com/share?text=Why using PESEL as a password is a very bad idea&amp;url=https://marcin-chwedczuk.github.io/why-using-pesel-as-a-password-is-a-very-bad-idea"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://marcin-chwedczuk.github.io/why-using-pesel-as-a-password-is-a-very-bad-idea"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=https://marcin-chwedczuk.github.io/why-using-pesel-as-a-password-is-a-very-bad-idea"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>
            
            <!-- Add Disqus Comments -->
            
                <div id="disqus_thread"></div>
<script>
    /**
    * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
    * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
    */
    
    var disqus_config = function () {
        this.page.url = 'https://marcin-chwedczuk.github.io//why-using-pesel-as-a-password-is-a-very-bad-idea';
        this.page.identifier = '/why-using-pesel-as-a-password-is-a-very-bad-idea';
    };
    
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    
    s.src = '//marcinchwedczukgithubio.disqus.com/embed.js';
    
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

            
            
        </footer>

    </article>

</main>

<aside class="read-next">

    <!-- [[! next_post ]] -->
    
        <a class="read-next-story " style="background-image: url(/assets/images/mc_cover2.jpg)" href="/reduce-cognitive-load">
            <section class="post">
                <h2>Reduce cognitive load for readers of your code</h2>
                <p>Recently I was reviewing a piece of code that was performing some computation on file...</p>
            </section>
        </a>
    
    <!-- [[! /next_post ]] -->
    <!-- [[! prev_post ]] -->
    
        <a class="read-next-story prev " style="background-image: url(/assets/images/mc_cover2.jpg)" href="/fluent-assertions-and-code-formatting">
            <section class="post">
                <h2>FluentAssertions and code formatting</h2>
                <p>Recently I was playing with FluentAssertions library. I was really amazed by the beautiful error...</p>
            </section>
        </a>
    
    <!-- [[! /prev_post ]] -->
</aside>

<!-- /post -->


        <footer class="site-footer clearfix">
          <section class="copyright"><a href="/">Programming is Magic</a> &copy; 2019</section>
          <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> using <a href="https://github.com/biomadeira/jasper">Jasper</a></section>
        </footer>
    </div>
    <!-- [[! Ghost outputs important scripts and data with this tag ]] -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <!-- [[! The main JavaScript file for Casper ]] -->
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/assets/js/index.js"></script>

    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-82096342-1', 'auto');
  ga('send', 'pageview');
</script>

</body>
</html>

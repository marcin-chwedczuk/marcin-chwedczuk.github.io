<!DOCTYPE html>
<html>
<head>
    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Page Meta -->
    <title>Creating and using annotations in Java</title>
    <meta name="description" content="A place where I share my thoughts about programming." />

    <!-- Mobile Meta -->
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Brand icon -->
    <link rel="shortcut icon" href="/assets/images/favicon.ico" >

    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css" />

    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!-- Ghost outputs important style and meta data with this tag -->
        <link rel="canonical" href="http://blog.marcinchwedczuk.pl//creating-and-using-adnotations-in-java" />
    <meta name="referrer" content="origin" />
    <link rel="next" href="/page2/" />

    <meta property="og:site_name" content="Programming is Magic" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Creating and using annotations in Java" />
    <meta property="og:description" content="A place where I share my thoughts about programming." />
    <meta property="og:url" content="http://blog.marcinchwedczuk.pl//creating-and-using-adnotations-in-java" />
    <meta property="og:image" content="/assets/images/cover7.jpg" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Creating and using annotations in Java" />
    <meta name="twitter:description" content="A place where I share my thoughts about programming." />
    <meta name="twitter:url" content="http://blog.marcinchwedczuk.pl//creating-and-using-adnotations-in-java" />
    <meta name="twitter:image:src" content="/assets/images/cover7.jpg" />

    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Website",
    "publisher": "Programming is Magic",
    "name": "Creating and using annotations in Java",
    "url": "http://blog.marcinchwedczuk.pl//creating-and-using-adnotations-in-java",
    "image": "/assets/images/cover7.jpg",
    "description": "A place where I share my thoughts about programming."
}
    </script>

    <meta name="generator" content="Jekyll 3.0.0" />
    <link rel="alternate" type="application/rss+xml" title="Programming is Magic" href="/feed.xml" />


</head>
<body class="home-template nav-closed">

    <!-- The blog navigation links -->
    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        <li class="nav-home " role="presentation"><a href="/">Home</a></li>
        <!-- <li class="nav-about " role="presentation"><a href="/about">About</a></li> -->

        
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/java">
                    java (29)
                    <!-- creating-and-using-adnotations-in-java name: java -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/dotnet">
                    dotnet (11)
                    <!-- creating-and-using-adnotations-in-java name: dotnet -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/algorithms">
                    algorithms (7)
                    <!-- creating-and-using-adnotations-in-java name: algorithms -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/architecture">
                    architecture (7)
                    <!-- creating-and-using-adnotations-in-java name: architecture -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/scala">
                    scala (7)
                    <!-- creating-and-using-adnotations-in-java name: scala -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/javascript">
                    javascript (5)
                    <!-- creating-and-using-adnotations-in-java name: javascript -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/csharp">
                    csharp (4)
                    <!-- creating-and-using-adnotations-in-java name: csharp -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/polish">
                    polish (4)
                    <!-- creating-and-using-adnotations-in-java name: polish -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/elektronika">
                    elektronika (3)
                    <!-- creating-and-using-adnotations-in-java name: elektronika -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/hibernate">
                    hibernate (3)
                    <!-- creating-and-using-adnotations-in-java name: hibernate -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/linux">
                    linux (3)
                    <!-- creating-and-using-adnotations-in-java name: linux -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/unit-testing">
                    unit-testing (3)
                    <!-- creating-and-using-adnotations-in-java name: unit-testing -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/hardware-review">
                    hardware-review (2)
                    <!-- creating-and-using-adnotations-in-java name: hardware-review -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/cheatsheet">
                    cheatsheet (1)
                    <!-- creating-and-using-adnotations-in-java name: cheatsheet -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/devcon">
                    devcon (1)
                    <!-- creating-and-using-adnotations-in-java name: devcon -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/eclipse">
                    eclipse (1)
                    <!-- creating-and-using-adnotations-in-java name: eclipse -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/functional-programming">
                    functional-programming (1)
                    <!-- creating-and-using-adnotations-in-java name: functional-programming -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/git">
                    git (1)
                    <!-- creating-and-using-adnotations-in-java name: git -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/hacking">
                    hacking (1)
                    <!-- creating-and-using-adnotations-in-java name: hacking -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/hardware">
                    hardware (1)
                    <!-- creating-and-using-adnotations-in-java name: hardware -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/kotlin">
                    kotlin (1)
                    <!-- creating-and-using-adnotations-in-java name: kotlin -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/low-level">
                    low-level (1)
                    <!-- creating-and-using-adnotations-in-java name: low-level -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/other">
                    other (1)
                    <!-- creating-and-using-adnotations-in-java name: other -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/postman">
                    postman (1)
                    <!-- creating-and-using-adnotations-in-java name: postman -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/powershell">
                    powershell (1)
                    <!-- creating-and-using-adnotations-in-java name: powershell -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/regex">
                    regex (1)
                    <!-- creating-and-using-adnotations-in-java name: regex -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/security">
                    security (1)
                    <!-- creating-and-using-adnotations-in-java name: security -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/sql">
                    sql (1)
                    <!-- creating-and-using-adnotations-in-java name: sql -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/ssh">
                    ssh (1)
                    <!-- creating-and-using-adnotations-in-java name: ssh -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/tips">
                    tips (1)
                    <!-- creating-and-using-adnotations-in-java name: tips -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/vim">
                    vim (1)
                    <!-- creating-and-using-adnotations-in-java name: vim -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/windows">
                    windows (1)
                    <!-- creating-and-using-adnotations-in-java name: windows -->
                </a>
            </li>
        

   </ul>
    <a class="subscribe-button icon-feed" href="/feed.xml">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The comment above "< default" means - insert everything in this file into -->
    <!-- the [body] of the default.hbs template, which contains our header/footer. -->

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->



<header class="main-header post-head " style="background-image: url(/assets/images/cover7.jpg) ">
    <nav class="main-nav  overlay  clearfix">
        <a class="blog-logo" href="/"><img src="/assets/images/home.png" alt="Blog Logo" /></a>
        
            <a class="menu-button icon-menu" href="#"><span class="word">Menu</span></a>
        
    </nav>
</header>

<main class="content" role="main">

    <article class="post tag-test tag-content">

        <header class="post-header">
            <h1 class="post-title">Creating and using annotations in Java</h1>
            <section class="post-meta">
            <!-- <a href='/'>mc</a> -->

            
                
                    <a href='/author/mc'>Marcin Chwedczuk</a>
                
            
            <time class="post-date" datetime="2016-06-06">06 Jun 2016</time>
                <!-- [[tags prefix=" on "]] -->
                
                on
                
                    
                       <a href='/tag/java'>Java</a>
                    
                
                
            </section>
        </header>

        <section class="post-content">

            <p>Java annotations are simple data that we can attach to program elements like
classes, fields or methods. True power of annotations lies in the fact that we
are able to retrieve this information at runtime. To demonstrate that we will create
simple annotation called <code class="highlighter-rouge">@RunAtStartup</code>. This annotation will allow programmers
to register classes that should be instantiated at program startup, programmers
will be able to specify class priority (via <code class="highlighter-rouge">priority</code> named element) and optionally
specify name of method that should be run on class instance (via <code class="highlighter-rouge">method</code> optional
element).</p>

<p>Here is example usage of <code class="highlighter-rouge">@RunAtStartup</code> annotation:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// StartupClass1.java:</span>
<span class="kn">package</span> <span class="n">mc</span><span class="o">.</span><span class="na">annotations</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">mc.annotations.RunAtStartup</span><span class="o">;</span>

<span class="nd">@RunAtStartup</span><span class="o">(</span><span class="n">priority</span> <span class="o">=</span> <span class="mi">10</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">StartupClass1</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Class 1 initialized!"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// StartupClass2.java:</span>
<span class="kn">package</span> <span class="n">mc</span><span class="o">.</span><span class="na">annotations</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">mc.annotations.RunAtStartup</span><span class="o">;</span>

<span class="nd">@RunAtStartup</span><span class="o">(</span><span class="n">priority</span> <span class="o">=</span> <span class="mi">100</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s">"initialize"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">StartupClass2</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">(</span><span class="s">"This method should not be called"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initialize</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Class 2 initialized!"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<!-- How to create annotations -->
<p>annotations are declared using <code class="highlighter-rouge">@interface</code> keyword, here is declaration of our
<code class="highlighter-rouge">@RunAtStartup</code> annotation:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">mc</span><span class="o">.</span><span class="na">annotations</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.lang.annotation.Retention</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.RetentionPolicy</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.Target</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.ElementType</span><span class="o">;</span>

<span class="nd">@Target</span><span class="o">(</span><span class="n">ElementType</span><span class="o">.</span><span class="na">TYPE</span><span class="o">)</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="n">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="n">RunAtStartup</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="nf">priority</span><span class="o">();</span>
    <span class="n">String</span> <span class="nf">method</span><span class="o">()</span> <span class="k">default</span> <span class="s">"run"</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure>

<p>annotation declaration is very similar to interface declaration, in fact annotations
are interfaces that are implemented by JVM behind the scene.</p>

<p>annotations can have zero or more elements (like <code class="highlighter-rouge">priority</code> or <code class="highlighter-rouge">method</code>), you can
provide default value for element via <code class="highlighter-rouge">default</code> keyword. If you provide default value
users won’t be required to specify element value when applying annotation. Notice
that we are providing default value for <code class="highlighter-rouge">method</code> element, thus we don’t need to provide it
in <code class="highlighter-rouge">StartupClass1</code> file, but still we are able to override default value 
as demonstrated in <code class="highlighter-rouge">StartupClass2</code> file. We always must provide value for elements
that doesn’t have default value.</p>

<p>Elements of annotation must have one of types:</p>

<ul>
  <li><code class="highlighter-rouge">boolean</code>, <code class="highlighter-rouge">byte</code>, <code class="highlighter-rouge">short</code>, <code class="highlighter-rouge">int</code>, <code class="highlighter-rouge">long</code> (wrapper classes like <code class="highlighter-rouge">Integer</code> cannot be used)</li>
  <li><code class="highlighter-rouge">String</code> type</li>
  <li>enum type</li>
  <li>class type</li>
  <li>another annotation type</li>
  <li>array of any of the above types</li>
</ul>

<p>For example:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="nd">@interface</span> <span class="n">TestAnnotation</span> <span class="o">{</span>
    <span class="n">Class</span><span class="o">&lt;</span><span class="n">Comparable</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">comparator</span><span class="o">();</span>
    <span class="kt">boolean</span> <span class="nf">ascendingSort</span><span class="o">();</span>
    <span class="n">String</span> <span class="nf">sortName</span><span class="o">();</span>
    <span class="n">String</span><span class="o">[]</span> <span class="nf">propertiesToSortBy</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

<p>There are two important standard annotations that help us create new annotations,
they are <code class="highlighter-rouge">@Target</code> and <code class="highlighter-rouge">@Retention</code>. <code class="highlighter-rouge">@Target</code> tells Java compiler on what program
elements annotation can be used, e.g. our <code class="highlighter-rouge">@RunAtStartup</code> annotation have 
<code class="highlighter-rouge">@Target(ElementType.Type)</code> target so it can be only used on classes and interfaces,
if we try to use it on field we get an error:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@RunAtStartup</span><span class="o">(</span><span class="n">priority</span> <span class="o">=</span> <span class="mi">20</span><span class="o">)</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">foo</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

<span class="c1">// Error: java: annotation type not applicable to this kind of declaration</span></code></pre></figure>

<p><code class="highlighter-rouge">@Retention</code> tells compiler and JVM if annotation should be accessible at runtime.
Some annotations exists only in Java source code, others exists
in <code class="highlighter-rouge">.class</code> files but cannot be accessed by reflection API, finally there are
annotations with retention <code class="highlighter-rouge">RetentionPolicy.RUNTIME</code> that can be accessed using 
reflection (our <code class="highlighter-rouge">@RunAtStartup</code> annotation is of that kind).</p>

<p>Finally there is a shortcut for creating annotations that have only single element,
if we name that element <code class="highlighter-rouge">value</code> we will be able to omit it name e.g.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// SimpleAnnotation.java:</span>
<span class="kn">package</span> <span class="n">mc</span><span class="o">.</span><span class="na">adnotations</span><span class="o">;</span>

<span class="kd">public</span> <span class="nd">@interface</span> <span class="n">SimpleAnnotation</span> <span class="o">{</span>
    <span class="n">String</span> <span class="nf">value</span><span class="o">()</span> <span class="k">default</span> <span class="s">"ok"</span><span class="o">;</span>
<span class="o">}</span>

<span class="c1">// Usage:</span>
<span class="nd">@SimpleAnnotation</span><span class="o">(</span><span class="s">"foo"</span><span class="o">)</span>
<span class="c1">// instead of @SimpleAnnotation(value = "foo")</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span></code></pre></figure>

<p>This also works with arrays:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// SimpleAnnotation.java:</span>
<span class="kn">package</span> <span class="n">mc</span><span class="o">.</span><span class="na">adnotations</span><span class="o">;</span>

<span class="kd">public</span> <span class="nd">@interface</span> <span class="n">SimpleAnnotation</span> <span class="o">{</span>
    <span class="n">String</span><span class="o">[]</span> <span class="nf">value</span><span class="o">()</span> <span class="k">default</span> <span class="o">{</span> <span class="s">"ok"</span> <span class="o">};</span>
<span class="o">}</span>

<span class="c1">// Usage:</span>
<span class="nd">@SimpleAnnotation</span><span class="o">({</span> <span class="s">"foo"</span><span class="o">,</span> <span class="s">"bar"</span> <span class="o">})</span>
<span class="c1">// instead of @SimpleAnnotation(value = { "foo", "bar" })</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span></code></pre></figure>

<p>TIP: For single element arrays we can write <code class="highlighter-rouge">@SimpleAnnotation("foo")</code> instead
of <code class="highlighter-rouge">@SimpleAnnotation({ "foo" })</code>.</p>

<p>Finally it’s time to implement <code class="highlighter-rouge">@RunAtStartup</code> behaviour. Unfortunately there is no
simple way to get list of all classes in a package in Java. To keep our example simple
we assume that our program is loaded from directory (not from <code class="highlighter-rouge">jar</code> archive), in
that case list of classes in a package is simply a list of <code class="highlighter-rouge">.class</code> files in package
directory. To get class files we use Java 7 new file API:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">Class</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">getAllClassesInPackageContaining</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span><span class="o">)</span> 
    <span class="kd">throws</span> <span class="n">IOException</span> 
<span class="o">{</span>
    <span class="n">String</span> <span class="n">clazzPackageName</span> <span class="o">=</span> <span class="n">clazz</span>
            <span class="o">.</span><span class="na">getPackage</span><span class="o">()</span>
            <span class="o">.</span><span class="na">getName</span><span class="o">();</span>

    <span class="n">String</span> <span class="n">clazzPath</span> <span class="o">=</span> <span class="n">clazz</span>
            <span class="o">.</span><span class="na">getResource</span><span class="o">(</span><span class="s">"."</span><span class="o">)</span>
            <span class="o">.</span><span class="na">getPath</span><span class="o">();</span>

    <span class="n">Path</span> <span class="n">packagePath</span> <span class="o">=</span> <span class="n">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">clazzPath</span><span class="o">)</span>
            <span class="o">.</span><span class="na">getParent</span><span class="o">();</span>

    <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Class</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">packageClasses</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>

    <span class="n">Files</span><span class="o">.</span><span class="na">walkFileTree</span><span class="o">(</span><span class="n">packagePath</span><span class="o">,</span> <span class="k">new</span> <span class="n">SimpleFileVisitor</span><span class="o">&lt;</span><span class="n">Path</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">FileVisitResult</span> <span class="nf">visitFile</span><span class="o">(</span>
                <span class="n">Path</span> <span class="n">file</span><span class="o">,</span> <span class="n">BasicFileAttributes</span> <span class="n">attrs</span><span class="o">)</span> 
                <span class="kd">throws</span> <span class="n">IOException</span> 
        <span class="o">{</span>
            <span class="n">String</span> <span class="n">filename</span> <span class="o">=</span> 
                <span class="n">file</span><span class="o">.</span><span class="na">getName</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">getNameCount</span><span class="o">()-</span><span class="mi">1</span><span class="o">).</span><span class="na">toString</span><span class="o">();</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">filename</span><span class="o">.</span><span class="na">endsWith</span><span class="o">(</span><span class="s">".class"</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">String</span> <span class="n">className</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="na">replace</span><span class="o">(</span><span class="s">".class"</span><span class="o">,</span> <span class="s">""</span><span class="o">);</span>

                <span class="k">try</span> <span class="o">{</span>
                    <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">loadedClazz</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span>
                        <span class="n">clazzPackageName</span> <span class="o">+</span> <span class="s">"."</span> <span class="o">+</span> <span class="n">className</span><span class="o">);</span>
                        
                    <span class="n">packageClasses</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">loadedClazz</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="k">catch</span><span class="o">(</span><span class="n">ClassNotFoundException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                        <span class="s">"class not found: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
                <span class="o">}</span>
            <span class="o">}</span>

            <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">visitFile</span><span class="o">(</span><span class="n">file</span><span class="o">,</span> <span class="n">attrs</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">});</span>

    <span class="k">return</span> <span class="n">packageClasses</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure>

<p>And our main program contained in <code class="highlighter-rouge">Main</code> class looks like this:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">RunAtStartupData</span> <span class="o">{</span>
    <span class="n">Object</span> <span class="n">object</span><span class="o">;</span>
    <span class="n">Method</span> <span class="n">method</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">priority</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">RunAtStartupData</span><span class="o">(</span>
        <span class="n">Object</span> <span class="n">object</span><span class="o">,</span> <span class="n">Method</span> <span class="n">method</span><span class="o">,</span> <span class="kt">int</span> <span class="n">priority</span><span class="o">)</span> 
    <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">object</span> <span class="o">=</span> <span class="n">object</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">method</span> <span class="o">=</span> <span class="n">method</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">priority</span> <span class="o">=</span> <span class="n">priority</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">callMethod</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">method</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">object</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Class</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">packageClasses</span> <span class="o">=</span>
        <span class="n">getAllClassesInPackageContaining</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="n">List</span><span class="o">&lt;</span><span class="n">RunAtStartupData</span><span class="o">&gt;</span> <span class="n">registrations</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>

    <span class="k">for</span> <span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span> <span class="o">:</span> <span class="n">packageClasses</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">RunAtStartup</span> <span class="n">runAtStartup</span> <span class="o">=</span> 
            <span class="n">clazz</span><span class="o">.</span><span class="na">getAnnotation</span><span class="o">(</span><span class="n">RunAtStartup</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">runAtStartup</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">continue</span><span class="o">;</span>

        <span class="n">Object</span> <span class="n">instance</span> <span class="o">=</span> <span class="n">clazz</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
        <span class="n">Method</span> <span class="n">method</span> <span class="o">=</span> <span class="n">clazz</span><span class="o">.</span><span class="na">getMethod</span><span class="o">(</span><span class="n">runAtStartup</span><span class="o">.</span><span class="na">method</span><span class="o">());</span>

        <span class="n">registrations</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">RunAtStartupData</span><span class="o">(</span>
            <span class="n">instance</span><span class="o">,</span> <span class="n">method</span><span class="o">,</span> <span class="n">runAtStartup</span><span class="o">.</span><span class="na">priority</span><span class="o">()));</span>
    <span class="o">}</span>

    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span>
        <span class="n">registrations</span><span class="o">,</span>
        <span class="n">Comparator</span><span class="o">.&lt;</span><span class="n">RunAtStartupData</span><span class="o">&gt;</span><span class="n">comparingInt</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span><span class="o">.</span><span class="na">priority</span><span class="o">)</span>
              <span class="o">.</span><span class="na">reversed</span><span class="o">());</span>

    <span class="k">for</span> <span class="o">(</span><span class="n">RunAtStartupData</span> <span class="n">registration</span> <span class="o">:</span> <span class="n">registrations</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">registration</span><span class="o">.</span><span class="na">callMethod</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>We use <code class="highlighter-rouge">clazz.getAnnotation(RunAtStartup.class)</code> to check if annotation was applied
to given class. Another tricky part is use of Java 8 lambda and new Comparator API
to sort all startup classes by their priorities (classes with higher priority should
run first).</p>


        </section>

        <footer class="post-footer">

            <!-- Everything inside the #author tags pulls data from the author -->
            <!-- #author-->
            
                
                    
                        <figure class="author-image">
                            <a class="img" href="/author/mc" style="background-image: url(/assets/images/mc.png)"><span class="hidden">mc's Picture</span></a>
                        </figure>
                    

                    <section class="author">
                        <h4><a href="/author/mc">Marcin Chwedczuk</a></h4>

                        
                            <p> A programmer, a geek, a human</p>
                        
                        <div class="author-meta">
                            <span class="author-location icon-location"> Warsaw, Poland</span>
                            <span class="author-link icon-link"><a href="http://marcinchwedczuk.pl"> http://marcinchwedczuk.pl</a></span>
                        </div>
                    </section>

                    <!-- /author  -->

                    <section class="share">
                        <h4>Share this post</h4>
                        <a class="icon-twitter" href="http://twitter.com/share?text=Creating and using annotations in Java&amp;url=http://blog.marcinchwedczuk.plcreating-and-using-adnotations-in-java"
                            onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                            <span class="hidden">Twitter</span>
                        </a>
                        <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.marcinchwedczuk.plcreating-and-using-adnotations-in-java"
                            onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                            <span class="hidden">Facebook</span>
                        </a>
                        <a class="icon-google-plus" href="https://plus.google.com/share?url=http://blog.marcinchwedczuk.plcreating-and-using-adnotations-in-java"
                           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                            <span class="hidden">Google+</span>
                        </a>
                    </section>
                
            

            <!-- Add Disqus Comments -->
            

        </footer>

    </article>

</main>

<aside class="read-next">

    <!-- [[! next_post ]] -->
    
        <a class="read-next-story " style="background-image: url(/assets/images/cover7.jpg)" href="/augmenting-JavaScript-objects-with-toString-and-valueOf">
            <section class="post">
                <h2>Augmenting JavaScript objects with toString and valueOf</h2>
                <p>Today I want to present two useful methods: `toString` and `valueOf`. Both of these methods...</p>
            </section>
        </a>
    
    <!-- [[! /next_post ]] -->
    <!-- [[! prev_post ]] -->
    
        <a class="read-next-story prev " style="background-image: url(/assets/images/cover7.jpg)" href="/break-out-of-code-block-in-java-and-javascript">
            <section class="post">
                <h2>Break out of block of code in Java and JavaScript</h2>
                <p>Java and JavaScript have a common feature that allows us to break out of nested...</p>
            </section>
        </a>
    
    <!-- [[! /prev_post ]] -->
</aside>

<!-- /post -->


        <!-- The tiny footer at the very bottom -->
        <footer class="site-footer clearfix">
          <section class="copyright"><a href="/">Programming is Magic</a> &copy; 2021</section>
          <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> using <a href="https://github.com/jekyller/jasper">Jasper</a></section>
        </footer>
    </div>
    <!-- highlight.js -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- jQuery needs to come before `` so that jQuery can be used in code injection -->
    <script type="text/javascript" src="//code.jquery.com/jquery-1.12.0.min.js"></script>
    <!-- Ghost outputs important scripts and data with this tag -->
    <!--  -->
    <!-- Add Google Analytics  -->
        <!-- Google Analytics Tracking code -->
     <script>
	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	    ga('create', 'UA-82096342-1', 'auto');
	    ga('send', 'pageview');

     </script>
    <!-- Fitvids makes video embeds responsive and awesome -->
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <!-- The main JavaScript file for Casper -->
    <script type="text/javascript" src="/assets/js/index.js"></script>

</body>
</html>

<!DOCTYPE html>
<html>
<head>
    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Page Meta -->
    <title>Java 8&#58 How to write custom collector</title>
    <meta name="description" content="A place where I share my thoughts about programming." />

    <!-- Mobile Meta -->
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Brand icon -->
    <link rel="shortcut icon" href="/assets/images/favicon.ico" >

    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css" />

    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!-- Ghost outputs important style and meta data with this tag -->
        <link rel="canonical" href="//java-8-how-to-write-custom-collector" />
    <meta name="referrer" content="origin" />
    <link rel="next" href="/page2/" />

    <meta property="og:site_name" content="Programming is Magic" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Java 8&#58 How to write custom collector" />
    <meta property="og:description" content="A place where I share my thoughts about programming." />
    <meta property="og:url" content="//java-8-how-to-write-custom-collector" />
    <meta property="og:image" content="/assets/images/mc_cover6.jpg" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Java 8&#58 How to write custom collector" />
    <meta name="twitter:description" content="A place where I share my thoughts about programming." />
    <meta name="twitter:url" content="//java-8-how-to-write-custom-collector" />
    <meta name="twitter:image:src" content="/assets/images/mc_cover6.jpg" />

    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Website",
    "publisher": "Programming is Magic",
    "name": "Java 8&#58 How to write custom collector",
    "url": "//java-8-how-to-write-custom-collector",
    "image": "/assets/images/mc_cover6.jpg",
    "description": "A place where I share my thoughts about programming."
}
    </script>

    <meta name="generator" content="Jekyll 3.0.0" />
    <link rel="alternate" type="application/rss+xml" title="Programming is Magic" href="/feed.xml" />


</head>
<body class="home-template nav-closed">

    <!-- The blog navigation links -->
    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        <li class="nav-home " role="presentation"><a href="/">Home</a></li>
        <!-- <li class="nav-about " role="presentation"><a href="/about">About</a></li> -->

        
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/java">
                    java (25)
                    <!-- java-8-how-to-write-custom-collector name: java -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/dotnet">
                    dotnet (11)
                    <!-- java-8-how-to-write-custom-collector name: dotnet -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/algorithms">
                    algorithms (7)
                    <!-- java-8-how-to-write-custom-collector name: algorithms -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/architecture">
                    architecture (7)
                    <!-- java-8-how-to-write-custom-collector name: architecture -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/javascript">
                    javascript (5)
                    <!-- java-8-how-to-write-custom-collector name: javascript -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/csharp">
                    csharp (4)
                    <!-- java-8-how-to-write-custom-collector name: csharp -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/hibernate">
                    hibernate (3)
                    <!-- java-8-how-to-write-custom-collector name: hibernate -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/linux">
                    linux (3)
                    <!-- java-8-how-to-write-custom-collector name: linux -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/unit-testing">
                    unit-testing (3)
                    <!-- java-8-how-to-write-custom-collector name: unit-testing -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/hardware-review">
                    hardware-review (2)
                    <!-- java-8-how-to-write-custom-collector name: hardware-review -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/scala">
                    scala (2)
                    <!-- java-8-how-to-write-custom-collector name: scala -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/devcon">
                    devcon (1)
                    <!-- java-8-how-to-write-custom-collector name: devcon -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/eclipse">
                    eclipse (1)
                    <!-- java-8-how-to-write-custom-collector name: eclipse -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/elektronika">
                    elektronika (1)
                    <!-- java-8-how-to-write-custom-collector name: elektronika -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/functional-programming">
                    functional-programming (1)
                    <!-- java-8-how-to-write-custom-collector name: functional-programming -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/git">
                    git (1)
                    <!-- java-8-how-to-write-custom-collector name: git -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/hacking">
                    hacking (1)
                    <!-- java-8-how-to-write-custom-collector name: hacking -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/java,">
                    java, (1)
                    <!-- java-8-how-to-write-custom-collector name: java, -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/kotlin">
                    kotlin (1)
                    <!-- java-8-how-to-write-custom-collector name: kotlin -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/low-level">
                    low-level (1)
                    <!-- java-8-how-to-write-custom-collector name: low-level -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/other">
                    other (1)
                    <!-- java-8-how-to-write-custom-collector name: other -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/polish">
                    polish (1)
                    <!-- java-8-how-to-write-custom-collector name: polish -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/postman">
                    postman (1)
                    <!-- java-8-how-to-write-custom-collector name: postman -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/powershell">
                    powershell (1)
                    <!-- java-8-how-to-write-custom-collector name: powershell -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/security">
                    security (1)
                    <!-- java-8-how-to-write-custom-collector name: security -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/sql">
                    sql (1)
                    <!-- java-8-how-to-write-custom-collector name: sql -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/tips">
                    tips (1)
                    <!-- java-8-how-to-write-custom-collector name: tips -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/vim">
                    vim (1)
                    <!-- java-8-how-to-write-custom-collector name: vim -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/windows">
                    windows (1)
                    <!-- java-8-how-to-write-custom-collector name: windows -->
                </a>
            </li>
        

   </ul>
    <a class="subscribe-button icon-feed" href="/feed.xml">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The comment above "< default" means - insert everything in this file into -->
    <!-- the [body] of the default.hbs template, which contains our header/footer. -->

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->



<header class="main-header post-head " style="background-image: url(/assets/images/mc_cover6.jpg) ">
    <nav class="main-nav  overlay  clearfix">
        <a class="blog-logo" href="/"><img src="/assets/images/home.png" alt="Blog Logo" /></a>
        
            <a class="menu-button icon-menu" href="#"><span class="word">Menu</span></a>
        
    </nav>
</header>

<main class="content" role="main">

    <article class="post tag-test tag-content">

        <header class="post-header">
            <h1 class="post-title">Java 8&#58 How to write custom collector</h1>
            <section class="post-meta">
            <!-- <a href='/'></a> -->

            
                
                    <a href='/author/mc'>Marcin Chwedczuk</a>
                
            
            <time class="post-date" datetime="2016-10-09">09 Oct 2016</time>
                <!-- [[tags prefix=" on "]] -->
                
                on
                
                    
                       <a href='/tag/java'>Java</a>
                    
                
                
            </section>
        </header>

        <section class="post-content">

            <p>In this post we will create custom collector that can be used
with Java 8 Stream API.</p>

<p>We will start by familiarising ourselves with the <code class="highlighter-rouge">Collector</code> interface:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">stream</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Collector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">,</span><span class="n">A</span><span class="o">,</span><span class="n">R</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="n">Supplier</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span> <span class="nf">supplier</span><span class="o">();</span>
    <span class="n">BiConsumer</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">accumulator</span><span class="o">();</span>
    <span class="n">BinaryOperator</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span> <span class="nf">combiner</span><span class="o">();</span>
    <span class="n">Function</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">R</span><span class="o">&gt;</span> <span class="nf">finisher</span><span class="o">();</span>
    <span class="n">Set</span><span class="o">&lt;</span><span class="n">Characteristics</span><span class="o">&gt;</span> <span class="nf">characteristics</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

<p>Before we move to explaining what each method should return, let’s see how
they are used in a simplified version of <code class="highlighter-rouge">Stream::collect</code>:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">,</span><span class="n">A</span><span class="o">,</span><span class="n">R</span><span class="o">&gt;</span> <span class="n">R</span> <span class="nf">collect</span><span class="o">(</span>
        <span class="n">Collector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">,</span><span class="n">A</span><span class="o">,</span><span class="n">R</span><span class="o">&gt;</span> <span class="n">collector</span><span class="o">,</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">elements</span><span class="o">)</span> <span class="o">{</span>

    <span class="n">Supplier</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span> <span class="n">supplier</span> <span class="o">=</span> <span class="n">collector</span><span class="o">.</span><span class="na">supplier</span><span class="o">();</span>
    <span class="n">A</span> <span class="n">acc</span> <span class="o">=</span> <span class="n">supplier</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>

    <span class="n">BiConsumer</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">accumulator</span> <span class="o">=</span> <span class="n">collector</span><span class="o">.</span><span class="na">accumulator</span><span class="o">();</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">T</span> <span class="nl">elem:</span> <span class="n">elements</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">accumulator</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">acc</span><span class="o">,</span> <span class="n">elem</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="n">Function</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">R</span><span class="o">&gt;</span> <span class="n">finisher</span> <span class="o">=</span> <span class="n">collector</span><span class="o">.</span><span class="na">finisher</span><span class="o">();</span>
    <span class="n">R</span> <span class="n">result</span> <span class="o">=</span> <span class="n">finisher</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">acc</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure>

<p>After seeing it usage we may describe <code class="highlighter-rouge">Collector</code> interface in more detail.
Let’s start with generic parameters used in declaration <code class="highlighter-rouge">Collector&lt;T,A,R&gt;</code>:</p>

<ul>
  <li><code class="highlighter-rouge">T</code> - type of stream elements</li>
  <li><code class="highlighter-rouge">A</code> - type of a helper object that will be used to
 keep partial results of <code class="highlighter-rouge">collect</code> operation. I will call this 
 helper object an <em>accumulator object</em></li>
  <li><code class="highlighter-rouge">R</code> - type of <code class="highlighter-rouge">collect</code> operation result</li>
</ul>

<p>Now we can move to describe methods required by <code class="highlighter-rouge">Collector</code> interface:</p>

<ul>
  <li><code class="highlighter-rouge">supplier()</code> - Method should return instance of <code class="highlighter-rouge">Supplier&lt;A&gt;</code> that will
 be used to create accumulator object(s). For parallel stream returned supplier may 
 be used to create many accumulator objects e.g. one per thread</li>
  <li><code class="highlighter-rouge">accumulator()</code> - This is the most important method of the interface.
 It should return instance of <code class="highlighter-rouge">BiConsumer&lt;A,T&gt;</code> that will be
 used to incorporate current stream element into accumulator object.
 For example for <code class="highlighter-rouge">sum()</code> collector <code class="highlighter-rouge">BiConsumer</code> will be responsible for adding
 current number to the partial sum kept in the accumulator object</li>
  <li><code class="highlighter-rouge">finisher()</code> - This method should return <code class="highlighter-rouge">Function&lt;A,R&gt;</code> that will transform
 accumulator object into final result</li>
  <li><code class="highlighter-rouge">combiner()</code> - For parallel stream more than one accumulator object
 may be used in single <code class="highlighter-rouge">collect</code> operation.
 This method returns <code class="highlighter-rouge">BinaryOperator&lt;A&gt;</code> that can be used to “merge”
 two accumulator objects into one. For example for <code class="highlighter-rouge">sum()</code> collector 
 <code class="highlighter-rouge">BinaryOperator</code> should just add partial sums contained in accumulator objects</li>
  <li><code class="highlighter-rouge">characteristics()</code> - This method should return <code class="highlighter-rouge">Set</code> of characteristics that
 describe current collector. The safe default is to return an empty set. Since
 this is an important topic we now move to describe it in more detail</li>
</ul>

<p>Every collector can have any combination of the following characteristics:</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">Characteristics.CONCURRENT</code> - This means that <em>accumulator object</em> returned
 by <code class="highlighter-rouge">suppier().get()</code> can be
 modified from many threads concurrently.
 Basically this flag means that during single <code class="highlighter-rouge">collect</code> operation parallel stream
 may use a single accumulator object and modify it
 from as many threads as it wants
 instead of creating many accumulator objects (one per thread) and then
 merging them via <code class="highlighter-rouge">combiner</code></p>
  </li>
  <li>
    <p><code class="highlighter-rouge">Characteristics.UNORDERED</code> - Specify this characteristics when result
 of the <code class="highlighter-rouge">collect</code> operation doesn’t depend on the order of stream elements
 (or more mathematically when collector is comutative).
 For example <code class="highlighter-rouge">toSet()</code> collector has this characteristics
 because resulting <code class="highlighter-rouge">Set</code> doesn’t depend on order of the stream elements.
 On the other hand <code class="highlighter-rouge">toList()</code>
 collector returns list that preserves order of elements in the original stream
 so it is ordered.<br />
 We must be careful when specifying this flag, for example
 at first you may say that <code class="highlighter-rouge">sum()</code> collector should be <code class="highlighter-rouge">UNORDERED</code>
 but when we take under account
 floating point overflow behaviour (+Infinity) it turns out
 that <code class="highlighter-rouge">sum()</code> must be ordered.<br />
 This characteristics is mostly useful when working with parallel streams.
 <code class="highlighter-rouge">UNORDERED</code> collector allows for more optimizations
 to be done during splitting
 stream into parts</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">Characteristics.IDENTITY_FINISH</code> - This characteristics means that <code class="highlighter-rouge">Function</code> returned
 by <code class="highlighter-rouge">finisher()</code> is identity and we may cast accumulator object straight to the result type</p>
  </li>
</ul>

<p>Now it’s time to write some code! We will create simple <code class="highlighter-rouge">MinMaxCollector</code> that
will compute both min and max element of the stream at the same time:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MinMaxCollector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>
        <span class="kd">implements</span> <span class="n">Collector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">,</span> 
                             <span class="n">MinMaxCollector</span><span class="o">.</span><span class="na">MinMaxAccumulator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;,</span>
                             <span class="n">MinMaxCollector</span><span class="o">.</span><span class="na">MinMax</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
   
<span class="c1">// here is our result type </span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">MinMax</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">min</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">max</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">MinMax</span><span class="o">(</span><span class="n">T</span> <span class="n">min</span><span class="o">,</span> <span class="n">T</span> <span class="n">max</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">min</span> <span class="o">=</span> <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="n">min</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">max</span> <span class="o">=</span> <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="n">max</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="o">...</span>
<span class="o">}</span>

<span class="c1">// here is our accumulator object</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">MinMaxAccumulator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Comparator</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">cmp</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">T</span> <span class="n">min</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">T</span> <span class="n">max</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">MinMaxAccumulator</span><span class="o">(</span><span class="n">Comparator</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">cmp</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">cmp</span> <span class="o">=</span> <span class="n">cmp</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">accumulate</span><span class="o">(</span><span class="n">T</span> <span class="n">elem</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">min</span> <span class="o">=</span> <span class="o">(</span><span class="n">min</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">cmp</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="n">elem</span><span class="o">,</span> <span class="n">min</span><span class="o">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> 
            <span class="o">?</span> <span class="n">elem</span> <span class="o">:</span> <span class="n">min</span><span class="o">;</span>

        <span class="n">max</span> <span class="o">=</span> <span class="o">(</span><span class="n">max</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">cmp</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="n">elem</span><span class="o">,</span> <span class="n">max</span><span class="o">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span>
            <span class="o">?</span> <span class="n">elem</span> <span class="o">:</span> <span class="n">max</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">MinMaxAccumulator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">combine</span><span class="o">(</span><span class="n">MinMaxAccumulator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">other</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">MinMax</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">otherMinMax</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="na">toMinMax</span><span class="o">();</span>
        <span class="n">otherMinMax</span><span class="o">.</span><span class="na">getMax</span><span class="o">().</span><span class="na">ifPresent</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">accumulate</span><span class="o">);</span>
        <span class="n">otherMinMax</span><span class="o">.</span><span class="na">getMin</span><span class="o">().</span><span class="na">ifPresent</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">accumulate</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">MinMax</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">toMinMax</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">MinMax</span><span class="o">&lt;&gt;(</span><span class="n">min</span><span class="o">,</span> <span class="n">max</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kd">final</span> <span class="n">Comparator</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">cmp</span><span class="o">;</span>

<span class="kd">public</span> <span class="nf">MinMaxCollector</span><span class="o">(</span><span class="n">Comparator</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">cmp</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">cmp</span> <span class="o">=</span> <span class="n">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">cmp</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">Supplier</span><span class="o">&lt;</span><span class="n">MinMaxAccumulator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="nf">supplier</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">MinMaxAccumulator</span><span class="o">&lt;&gt;(</span><span class="n">cmp</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">BiConsumer</span><span class="o">&lt;</span><span class="n">MinMaxAccumulator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="nf">accumulator</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nl">MinMaxAccumulator:</span><span class="o">:</span><span class="n">accumulate</span><span class="o">;</span>
<span class="o">}</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">BinaryOperator</span><span class="o">&lt;</span><span class="n">MinMaxAccumulator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="nf">combiner</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nl">MinMaxAccumulator:</span><span class="o">:</span><span class="n">combine</span><span class="o">;</span>
<span class="o">}</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">Function</span><span class="o">&lt;</span><span class="n">MinMaxAccumulator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;,</span> <span class="n">MinMax</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="nf">finisher</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nl">MinMaxAccumulator:</span><span class="o">:</span><span class="n">toMinMax</span><span class="o">;</span>
<span class="o">}</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Characteristics</span><span class="o">&gt;</span> <span class="nf">characteristics</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Collections</span><span class="o">.</span><span class="na">emptySet</span><span class="o">();</span>
<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>Some remarks:</p>

<ul>
  <li>In our example methods that were responsible for computing min/max were
 defined on accumulator object. Some people don’t like this approach, instead
 they define all logic inside lambda expressions and use accumulator object
 to only keep data. For me this is just a mater of taste</li>
  <li>For simple collectors like <code class="highlighter-rouge">sum()</code> you don’t need to define a new accumulator
 object class, <code class="highlighter-rouge">new long[1]</code> will do the job</li>
</ul>

<p>Finally let’s see how we may use our newly created collector:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Box</span><span class="o">&gt;</span> <span class="n">boxes</span> <span class="o">=</span> <span class="n">Stream</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
    <span class="k">new</span> <span class="nf">Box</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span>
    <span class="k">new</span> <span class="nf">Box</span><span class="o">(</span><span class="mf">3.2</span><span class="o">),</span>
    <span class="k">new</span> <span class="nf">Box</span><span class="o">(</span><span class="mf">0.4</span><span class="o">),</span>
    <span class="k">new</span> <span class="nf">Box</span><span class="o">(</span><span class="mf">4.1</span><span class="o">),</span>
    <span class="k">new</span> <span class="nf">Box</span><span class="o">(</span><span class="mf">0.11</span><span class="o">)</span>
<span class="o">);</span>

<span class="n">MinMaxCollector</span><span class="o">.</span><span class="na">MinMax</span><span class="o">&lt;</span><span class="n">Box</span><span class="o">&gt;</span> <span class="n">boxMinMax</span> <span class="o">=</span> <span class="n">boxes</span>
    <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="k">new</span> <span class="n">MinMaxCollector</span><span class="o">&lt;&gt;(</span><span class="n">comparing</span><span class="o">(</span><span class="nl">Box:</span><span class="o">:</span><span class="n">getWeight</span><span class="o">)));</span>

<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">boxMinMax</span><span class="o">);</span>
<span class="c1">// Output:</span>
<span class="c1">// MinMax{min=Optional[Box{weight=0.11}], </span>
<span class="c1">//        max=Optional[Box{weight=4.1}]}</span></code></pre></figure>

<p>That’s all, thanks for reading!</p>


        </section>

        <footer class="post-footer">

            <!-- Everything inside the #author tags pulls data from the author -->
            <!-- #author-->
            
                
                    
                        <figure class="author-image">
                            <a class="img" href="/author/mc" style="background-image: url(/assets/images/mc.png)"><span class="hidden">mc's Picture</span></a>
                        </figure>
                    

                    <section class="author">
                        <h4><a href="/author/mc">Marcin Chwedczuk</a></h4>

                        
                            <p> A programmer, a geek, a human</p>
                        
                        <div class="author-meta">
                            <span class="author-location icon-location"> Warsaw, Poland</span>
                            <span class="author-link icon-link"><a href="http://marcinchwedczuk.pl"> http://marcinchwedczuk.pl</a></span>
                        </div>
                    </section>

                    <!-- /author  -->

                    <section class="share">
                        <h4>Share this post</h4>
                        <a class="icon-twitter" href="http://twitter.com/share?text=Java 8&#58 How to write custom collector&amp;url=java-8-how-to-write-custom-collector"
                            onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                            <span class="hidden">Twitter</span>
                        </a>
                        <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=java-8-how-to-write-custom-collector"
                            onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                            <span class="hidden">Facebook</span>
                        </a>
                        <a class="icon-google-plus" href="https://plus.google.com/share?url=java-8-how-to-write-custom-collector"
                           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                            <span class="hidden">Google+</span>
                        </a>
                    </section>
                
            

            <!-- Add Disqus Comments -->
            
                <div id="disqus_thread"></div>
<script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'marcinchwedczukgithubio'; // required: replace example with your forum shortname
        var disqus_identifier = '/java-8-how-to-write-custom-collector';
        var disqus_url = '/java-8-how-to-write-custom-collector';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>

            

        </footer>

    </article>

</main>

<aside class="read-next">

    <!-- [[! next_post ]] -->
    
        <a class="read-next-story " style="background-image: url(/assets/images/mc_cover6.jpg)" href="/notes-on-spring-xml-configuration">
            <section class="post">
                <h2>Notes on Spring XML configuration</h2>
                <p>This post is below my usual quality standards, it's just bunch of notes that I...</p>
            </section>
        </a>
    
    <!-- [[! /next_post ]] -->
    <!-- [[! prev_post ]] -->
    
        <a class="read-next-story prev " style="background-image: url(/assets/images/mc_cover2.jpg)" href="/grouping-using-java-8-streams">
            <section class="post">
                <h2>Grouping using Java 8 streams</h2>
                <p>In this post we will learn how to perform grouping using new Java 8 Stream...</p>
            </section>
        </a>
    
    <!-- [[! /prev_post ]] -->
</aside>

<!-- /post -->


        <!-- The tiny footer at the very bottom -->
        <footer class="site-footer clearfix">
          <section class="copyright"><a href="/">Programming is Magic</a> &copy; 2020</section>
          <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> using <a href="https://github.com/jekyller/jasper">Jasper</a></section>
        </footer>
    </div>
    <!-- highlight.js -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- jQuery needs to come before `` so that jQuery can be used in code injection -->
    <script type="text/javascript" src="//code.jquery.com/jquery-1.12.0.min.js"></script>
    <!-- Ghost outputs important scripts and data with this tag -->
    <!--  -->
    <!-- Add Google Analytics  -->
        <!-- Google Analytics Tracking code -->
     <script>
	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	    ga('create', 'UA-82096342-1', 'auto');
	    ga('send', 'pageview');

     </script>
    <!-- Fitvids makes video embeds responsive and awesome -->
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <!-- The main JavaScript file for Casper -->
    <script type="text/javascript" src="/assets/js/index.js"></script>

</body>
</html>

<!DOCTYPE html>
<html>
<head>
    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Page Meta -->
    <title>Useful JDK tools (part 1)</title>
    <meta name="description" content="A place where I share my thoughts about programming." />

    <!-- Mobile Meta -->
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Brand icon -->
    <link rel="shortcut icon" href="/assets/images/favicon.ico" >

    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css" />

    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!-- Ghost outputs important style and meta data with this tag -->
        <link rel="canonical" href="http://localhost:4000//useful-jdk-tools-part-1" />
    <meta name="referrer" content="origin" />
    <link rel="next" href="/page2/" />

    <meta property="og:site_name" content="Programming is Magic" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Useful JDK tools (part 1)" />
    <meta property="og:description" content="A place where I share my thoughts about programming." />
    <meta property="og:url" content="http://localhost:4000//useful-jdk-tools-part-1" />
    <meta property="og:image" content="/assets/images/mc_cover4.jpg" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Useful JDK tools (part 1)" />
    <meta name="twitter:description" content="A place where I share my thoughts about programming." />
    <meta name="twitter:url" content="http://localhost:4000//useful-jdk-tools-part-1" />
    <meta name="twitter:image:src" content="/assets/images/mc_cover4.jpg" />

    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Website",
    "publisher": "Programming is Magic",
    "name": "Useful JDK tools (part 1)",
    "url": "http://localhost:4000//useful-jdk-tools-part-1",
    "image": "/assets/images/mc_cover4.jpg",
    "description": "A place where I share my thoughts about programming."
}
    </script>

    <meta name="generator" content="Jekyll 3.0.0" />
    <link rel="alternate" type="application/rss+xml" title="Programming is Magic" href="/feed.xml" />


</head>
<body class="home-template nav-closed">

    <!-- The blog navigation links -->
    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        <li class="nav-home " role="presentation"><a href="/">Home</a></li>
        <!-- <li class="nav-about " role="presentation"><a href="/about">About</a></li> -->

        
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/java">
                    java (28)
                    <!-- useful-jdk-tools-part-1 name: java -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/dotnet">
                    dotnet (11)
                    <!-- useful-jdk-tools-part-1 name: dotnet -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/algorithms">
                    algorithms (7)
                    <!-- useful-jdk-tools-part-1 name: algorithms -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/architecture">
                    architecture (7)
                    <!-- useful-jdk-tools-part-1 name: architecture -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/scala">
                    scala (7)
                    <!-- useful-jdk-tools-part-1 name: scala -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/javascript">
                    javascript (5)
                    <!-- useful-jdk-tools-part-1 name: javascript -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/csharp">
                    csharp (4)
                    <!-- useful-jdk-tools-part-1 name: csharp -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/hibernate">
                    hibernate (3)
                    <!-- useful-jdk-tools-part-1 name: hibernate -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/linux">
                    linux (3)
                    <!-- useful-jdk-tools-part-1 name: linux -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/polish">
                    polish (3)
                    <!-- useful-jdk-tools-part-1 name: polish -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/unit-testing">
                    unit-testing (3)
                    <!-- useful-jdk-tools-part-1 name: unit-testing -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/elektronika">
                    elektronika (2)
                    <!-- useful-jdk-tools-part-1 name: elektronika -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/hardware-review">
                    hardware-review (2)
                    <!-- useful-jdk-tools-part-1 name: hardware-review -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/cheatsheet">
                    cheatsheet (1)
                    <!-- useful-jdk-tools-part-1 name: cheatsheet -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/devcon">
                    devcon (1)
                    <!-- useful-jdk-tools-part-1 name: devcon -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/eclipse">
                    eclipse (1)
                    <!-- useful-jdk-tools-part-1 name: eclipse -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/functional-programming">
                    functional-programming (1)
                    <!-- useful-jdk-tools-part-1 name: functional-programming -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/git">
                    git (1)
                    <!-- useful-jdk-tools-part-1 name: git -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/hacking">
                    hacking (1)
                    <!-- useful-jdk-tools-part-1 name: hacking -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/hardware">
                    hardware (1)
                    <!-- useful-jdk-tools-part-1 name: hardware -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/kotlin">
                    kotlin (1)
                    <!-- useful-jdk-tools-part-1 name: kotlin -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/low-level">
                    low-level (1)
                    <!-- useful-jdk-tools-part-1 name: low-level -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/other">
                    other (1)
                    <!-- useful-jdk-tools-part-1 name: other -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/postman">
                    postman (1)
                    <!-- useful-jdk-tools-part-1 name: postman -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/powershell">
                    powershell (1)
                    <!-- useful-jdk-tools-part-1 name: powershell -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/regex">
                    regex (1)
                    <!-- useful-jdk-tools-part-1 name: regex -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/security">
                    security (1)
                    <!-- useful-jdk-tools-part-1 name: security -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/sql">
                    sql (1)
                    <!-- useful-jdk-tools-part-1 name: sql -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/tips">
                    tips (1)
                    <!-- useful-jdk-tools-part-1 name: tips -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/vim">
                    vim (1)
                    <!-- useful-jdk-tools-part-1 name: vim -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/windows">
                    windows (1)
                    <!-- useful-jdk-tools-part-1 name: windows -->
                </a>
            </li>
        

   </ul>
    <a class="subscribe-button icon-feed" href="/feed.xml">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The comment above "< default" means - insert everything in this file into -->
    <!-- the [body] of the default.hbs template, which contains our header/footer. -->

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->



<header class="main-header post-head " style="background-image: url(/assets/images/mc_cover4.jpg) ">
    <nav class="main-nav  overlay  clearfix">
        <a class="blog-logo" href="/"><img src="/assets/images/home.png" alt="Blog Logo" /></a>
        
            <a class="menu-button icon-menu" href="#"><span class="word">Menu</span></a>
        
    </nav>
</header>

<main class="content" role="main">

    <article class="post tag-test tag-content">

        <header class="post-header">
            <h1 class="post-title">Useful JDK tools (part 1)</h1>
            <section class="post-meta">
            <!-- <a href='/'></a> -->

            
                
                    <a href='/author/mc'>Marcin Chwedczuk</a>
                
            
            <time class="post-date" datetime="2020-07-10">10 Jul 2020</time>
                <!-- [[tags prefix=" on "]] -->
                
                on
                
                    
                       <a href='/tag/java'>Java</a>
                    
                
                
            </section>
        </header>

        <section class="post-content">

            <p>JDK comes with a bunch of handy tools. It’s good to
know about them. In this post we will take a look at
<code class="highlighter-rouge">jps</code>, <code class="highlighter-rouge">jstack</code>, <code class="highlighter-rouge">jmap</code> and <code class="highlighter-rouge">jhat</code>.</p>

<h3 id="jps">jps</h3>

<p><code class="highlighter-rouge">jps</code> is a JVM counterpart to unix <code class="highlighter-rouge">ps</code> command.
By default <code class="highlighter-rouge">jps</code> prints process PID and 
the name of the main class
or the name of a jar file if the 
application was started using <code class="highlighter-rouge">java -jar</code> option.</p>

<figure class="highlight"><pre><code class="language-nohighlight" data-lang="nohighlight">$ jps
54177 Jps
54173 App
54452 app.jar</code></pre></figure>

<p>But it can be more talkative. 
<code class="highlighter-rouge">-l</code> option adds a package name to the
main class name and a full/relative path to the jar filename.
<code class="highlighter-rouge">-m</code> option will print command line arguments passed to the program.</p>

<figure class="highlight"><pre><code class="language-nohighlight" data-lang="nohighlight">$ jps -lm
54355 pl.marcinchwedczuk.app.App arg1 arg2 arg3
54452 build/libs/app.jar arg1 arg2 arg3
54458 jdk.jcmd/sun.tools.jps.Jps -lm</code></pre></figure>

<p>To print JVM switches we use <code class="highlighter-rouge">-v</code> option:</p>

<figure class="highlight"><pre><code class="language-nohighlight" data-lang="nohighlight">$ jps -v
54654 app.jar -Xmx32m -Xms32m
54657 Jps -Dapplication.home=... -Xms8m ...</code></pre></figure>

<h3 id="jstack">jstack</h3>

<p><code class="highlighter-rouge">jstack PID</code> can be used to print current stack traces of
all threads running in java process.
You can also print stack traces from a core dump file.
The output of <code class="highlighter-rouge">jstack</code> command is often referred to
as a <em>thread dump</em>.</p>

<p>Thread dumps are invaluable resources when it comes to debugging
nasty deadlocks that show up only on the production servers.
On the other hand the number of threads in a serious java application
can be overwhelming. To make the most of thread dumps, you
need to give threads meaningful names. You should give names 
(via <code class="highlighter-rouge">Thread::setName</code>) at least to the threads that you create 
yourself and 
you should also supply a “thread naming” <code class="highlighter-rouge">ThreadFactory</code> when creating
new thread pools (e.g. <code class="highlighter-rouge">newFixedThreadPool(int nThreads, ThreadFactory threadFactory)</code>).</p>

<p>Let’s create a simple app that deadlocks and see what <code class="highlighter-rouge">jstack</code>
will print:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
	<span class="n">Lock</span> <span class="n">l1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ReentrantLock</span><span class="o">();</span>
	<span class="n">Lock</span> <span class="n">l2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ReentrantLock</span><span class="o">();</span>

	<span class="n">var</span> <span class="n">t1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
		<span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">setName</span><span class="o">(</span><span class="s">"AppThread#1"</span><span class="o">);</span>
		<span class="n">l1</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">interrupt</span><span class="o">();</span>
		<span class="o">}</span>
		<span class="n">l2</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
	<span class="o">});</span>

	<span class="n">var</span> <span class="n">t2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
		<span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">setName</span><span class="o">(</span><span class="s">"AppThread#2"</span><span class="o">);</span>
		<span class="n">l2</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">interrupt</span><span class="o">();</span>
		<span class="o">}</span>
		<span class="n">l1</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
	<span class="o">});</span>

	<span class="n">t1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span> <span class="n">t2</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
	<span class="n">t1</span><span class="o">.</span><span class="na">join</span><span class="o">();</span> <span class="n">t2</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

<p>EDIT: I was tired when I wrote this code. It will deadlock
both threads
say 99% of time but not always. Instead of <code class="highlighter-rouge">sleep</code> I should use
<code class="highlighter-rouge">CountDownLatch</code>. I leave the code as it is as I don’t want to regenerate
thread dumps but I wanted to point out this problem.</p>

<p>For readability I had to shorten <code class="highlighter-rouge">jstack</code> output.</p>

<figure class="highlight"><pre><code class="language-nohighlight" data-lang="nohighlight">$ jstack `jps | grep App | cut -d ' ' -f 1`

"main" #1 prio=5 os_prio=31 cpu=46.25ms elapsed=85.17s tid=0x00007fb623810800 nid=0x1803 in Object.wait()  [0x000070000027a000]
   java.lang.Thread.State: WAITING (on object monitor)
	at java.lang.Object.wait(java.base@14.0.1/Native Method)
	...
	at java.lang.Thread.join(java.base@14.0.1/Thread.java:1371)
	at pl.marcinchwedczuk.bzzz.App.main(App.java:37)

"AppThread#1" #13 prio=5 os_prio=31 cpu=1.30ms elapsed=85.12s tid=0x00007fb622031000 nid=0x9b03 waiting on condition  [0x00007000014b3000]
   java.lang.Thread.State: WAITING (parking)
	at jdk.internal.misc.Unsafe.park(java.base@14.0.1/Native Method)
	...
	at java.util.concurrent.locks.ReentrantLock.lock(java.base@14.0.1/ReentrantLock.java:322)
	at pl.marcinchwedczuk.bzzz.App.lambda$main$0(App.java:22)
	at pl.marcinchwedczuk.bzzz.App$$Lambda$1/0x0000000800b65840.run(Unknown Source)
	at java.lang.Thread.run(java.base@14.0.1/Thread.java:832)
...
Found one Java-level deadlock:
=============================
"AppThread#1":
  waiting for ownable synchronizer 0x00000007ffd92998, (a java.util.concurrent.locks.ReentrantLock$NonfairSync),
  which is held by "AppThread#2"

"AppThread#2":
  waiting for ownable synchronizer 0x00000007ffd92968, (a java.util.concurrent.locks.ReentrantLock$NonfairSync),
  which is held by "AppThread#1"
...</code></pre></figure>

<p>Notice that JVM was able to detect the deadlock, saving us a hours
of debugging. If you have a heisenbug you may consider running
<code class="highlighter-rouge">jstack</code> periodically and searching its output for <code class="highlighter-rouge">Found * deadlock</code> lines.</p>

<p>Now let’s see how we can extract thread dumps for a core dump.
And for that we need a core dump.</p>

<p>Here I will describe how to make a core dump on macOS 10.15
(this is based on <a href="https://developer.apple.com/library/archive/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECCOREDUMPS">this article</a>)
First we need to execute <code class="highlighter-rouge">ulimit -c unlimited</code> in the shell
to remove the file size limit on created core-dump files.
A simple crashing hello world C program can create about 2GB core dump,
Java cores can have sizes of 10GB or more.
Then we need to set appropriate
permissions for <code class="highlighter-rouge">/cores</code> directory:</p>

<figure class="highlight"><pre><code class="language-nohighlight" data-lang="nohighlight">$ sudo chmod 1777 /cores
# Test if we have enough permissions
$ echo 1 &gt; /cores/test</code></pre></figure>

<p>TIP: <code class="highlighter-rouge">1</code> in <code class="highlighter-rouge">1777</code> is for <a href="https://en.wikipedia.org/wiki/Sticky_bit">sticky bit</a>.
If a directory has this bit set then 
only the owner of a file contained in that directory
can remove or rename that file.
If we additionally create a file with <code class="highlighter-rouge">700</code> permissions 
then nobody beyond us will be able to change or
remove the file.</p>

<p>Then <em>in the same</em> shell in which we executed <code class="highlighter-rouge">ulimit -c unlimited</code>
we have to run a java application and in a new
terminal window we need to send <code class="highlighter-rouge">SIGSEGV</code> to that app:</p>

<figure class="highlight"><pre><code class="language-nohighlight" data-lang="nohighlight">$ kill -SIGSEGV PID</code></pre></figure>

<p>After being hit by <code class="highlighter-rouge">SIGSEGV</code> Java should crash with a message:</p>

<figure class="highlight"><pre><code class="language-nohighlight" data-lang="nohighlight">$ java -jar build/libs/bzzz.jar
# A fatal error has been detected by the Java Runtime Environment:
#
#  SIGSEGV (0xb) at pc=0x00007fff6f4cfdfa, pid=55303, tid=775
...
# Core dump will be written. Default location: /cores/core.56128
...</code></pre></figure>

<p>It may take a while to write 10GB+ file on disk so be patient.</p>

<p>Now for some reason I was not able to take a core dump from
official Oracle distribution of JDK. When I used OpenJDK
build everything worked perfectly. Now when I switched to OpenJDK
I have to use OpenJDKs <code class="highlighter-rouge">jstack</code> to analyze the core dump.</p>

<figure class="highlight"><pre><code class="language-nohighlight" data-lang="nohighlight">$ export PATH=/usr/local/Cellar/openjdk/14.0.1/bin:$PATH
$ jhsdb jstack --core /cores/core.56128 \
	 --exe /usr/local/Cellar/openjdk/14.0.1/bin/java

"main" #1 prio=5 tid=0x00007fb4c300c000 nid=0x1d03 in Object.wait() [0x00007000027db000]
   java.lang.Thread.State: WAITING (on object monitor)
   JavaThread state: _thread_blocked
 - java.lang.Object.wait(long) @bci=0 (Interpreted frame)
	- waiting on &lt;0x000000061fe55d88&gt; (a java.lang.Thread)
 - java.lang.Thread.join(long) @bci=72, line=1303 (Interpreted frame)
	- locked &lt;0x000000061fe55d88&gt; (a java.lang.Thread)
 - java.lang.Thread.join() @bci=2, line=1371 (Interpreted frame)
 - pl.marcinchwedczuk.bzzz.App.main(java.lang.String[]) @bci=57, line=37 (Interpreted frame)
...</code></pre></figure>

<p>For some reason in OpenJDK 14 the command <code class="highlighter-rouge">jstack /path/to/java coredump</code>
did not work. Instead I have to use a new tool introduced in JDK9
called <code class="highlighter-rouge">jhsdb</code>. Anyway the result is the same, we managed to
get thread dumps from the core dump. Again the tool was smart enough
to point out the deadlock (not visible on attached listing).</p>

<p>OK lets cleanup our system and revert the settings:
<code class="highlighter-rouge">ulimit -c 0</code>, <code class="highlighter-rouge">rm /cores/*</code> and <code class="highlighter-rouge">sudo chmod 1775 /cores</code>.</p>

<h3 id="jmap">jmap</h3>

<p><code class="highlighter-rouge">jmap</code> can be used to display various info about
Java process heap. For example we may take a heap 
histogram, which tells us number of instances and
total memory size taken per class.</p>

<figure class="highlight"><pre><code class="language-nohighlight" data-lang="nohighlight">$ jmap -histo $PID | head
No dump file specified
 num     #instances         #bytes  class name (module)
-------------------------------------------------------
   1:           965        2775128  [I (java.base@14.0.1)
   2:          7555         399568  [B (java.base@14.0.1)
   3:          7324         175776  java.lang.String (java.base@14.0.1)
   4:          1295         160512  java.lang.Class (java.base@14.0.1)
   5:           964          88712  [Ljava.lang.Object; (java.base@14.0.1)
   6:          1872          59904  java.util.HashMap$Node (java.base@14.0.1)</code></pre></figure>

<p>But the real power of <code class="highlighter-rouge">jmap</code> lies in its ability
to take heap dumps:</p>

<figure class="highlight"><pre><code class="language-nohighlight" data-lang="nohighlight">$ jmap -dump:live,format=b,file=heapdump $PID
Dumping heap to /path/to/heapdump ...
Heap dump file created [4264220 bytes in 0.018 secs]</code></pre></figure>

<p>Heapdumps can then be comfortably opened and analyzed in tools like
<a href="https://www.eclipse.org/mat/">Eclipse Memory Analyzer</a>.</p>

<p><img src="assets/images/2020-07-10/ema.png" alt="Eclipse Memory Analyzer" /></p>

<p>Heapdumps can be quite huge, if you want to move them between
servers remember to first compress them to speed things up.
They also contain sensitive data like AWS access
keys and user passwords, so please keep them secure.</p>

<p>TIP: You can also generate heapdumps on
out of memory errors using <code class="highlighter-rouge">-XX:+HeapDumpOnOutOfMemoryError</code> JVM switch.</p>

<p>EDIT: Since JDK9 the recommended way of generating heapdumps
changed. You may want to see <a href="https://www.infoq.com/news/2015/12/OpenJDK-9-removal-of-HPROF-jhat/">this article on InfoQ</a>.</p>

<h3 id="jhat">jhat</h3>

<p>Now what if you don’t want/have permissions to install fancy heapdump analyzers?
Not all is lost, we may still use primitive but working <code class="highlighter-rouge">jhat</code>.
Run <code class="highlighter-rouge">jhat heapdump</code> to start <code class="highlighter-rouge">jhat</code> HTTP server with basic
heapdump browser.</p>

<p>EDIT: Unfortunately <code class="highlighter-rouge">jhat</code> was removed in JDK9.</p>


        </section>

        <footer class="post-footer">

            <!-- Everything inside the #author tags pulls data from the author -->
            <!-- #author-->
            
                
                    
                        <figure class="author-image">
                            <a class="img" href="/author/mc" style="background-image: url(/assets/images/mc.png)"><span class="hidden">mc's Picture</span></a>
                        </figure>
                    

                    <section class="author">
                        <h4><a href="/author/mc">Marcin Chwedczuk</a></h4>

                        
                            <p> A programmer, a geek, a human</p>
                        
                        <div class="author-meta">
                            <span class="author-location icon-location"> Warsaw, Poland</span>
                            <span class="author-link icon-link"><a href="http://marcinchwedczuk.pl"> http://marcinchwedczuk.pl</a></span>
                        </div>
                    </section>

                    <!-- /author  -->

                    <section class="share">
                        <h4>Share this post</h4>
                        <a class="icon-twitter" href="http://twitter.com/share?text=Useful JDK tools (part 1)&amp;url=http://localhost:4000useful-jdk-tools-part-1"
                            onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                            <span class="hidden">Twitter</span>
                        </a>
                        <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000useful-jdk-tools-part-1"
                            onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                            <span class="hidden">Facebook</span>
                        </a>
                        <a class="icon-google-plus" href="https://plus.google.com/share?url=http://localhost:4000useful-jdk-tools-part-1"
                           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                            <span class="hidden">Google+</span>
                        </a>
                    </section>
                
            

            <!-- Add Disqus Comments -->
            
                <div id="disqus_thread"></div>
<script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'marcinchwedczukgithubio'; // required: replace example with your forum shortname
        var disqus_identifier = '/useful-jdk-tools-part-1';
        var disqus_url = 'http://localhost:4000/useful-jdk-tools-part-1';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>

            

        </footer>

    </article>

</main>

<aside class="read-next">

    <!-- [[! next_post ]] -->
    
        <a class="read-next-story " style="background-image: url(/assets/images/mc_cover4.jpg)" href="/scala-nesting-monads">
            <section class="post">
                <h2>Nesting monads in Scala</h2>
                <p>Recently I write a lot of async code. Most of my repository methods return types...</p>
            </section>
        </a>
    
    <!-- [[! /next_post ]] -->
    <!-- [[! prev_post ]] -->
    
        <a class="read-next-story prev " style="background-image: url(/assets/images/mc_cover4.jpg)" href="/iterm2-cheat-sheet">
            <section class="post">
                <h2>iTerm2 cheat sheet</h2>
                <p>iTerm2 is one of the best terminal emulators out there. But to appreciate its full...</p>
            </section>
        </a>
    
    <!-- [[! /prev_post ]] -->
</aside>

<!-- /post -->


        <!-- The tiny footer at the very bottom -->
        <footer class="site-footer clearfix">
          <section class="copyright"><a href="/">Programming is Magic</a> &copy; 2020</section>
          <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> using <a href="https://github.com/jekyller/jasper">Jasper</a></section>
        </footer>
    </div>
    <!-- highlight.js -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- jQuery needs to come before `` so that jQuery can be used in code injection -->
    <script type="text/javascript" src="//code.jquery.com/jquery-1.12.0.min.js"></script>
    <!-- Ghost outputs important scripts and data with this tag -->
    <!--  -->
    <!-- Add Google Analytics  -->
        <!-- Google Analytics Tracking code -->
     <script>
	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	    ga('create', 'UA-82096342-1', 'auto');
	    ga('send', 'pageview');

     </script>
    <!-- Fitvids makes video embeds responsive and awesome -->
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <!-- The main JavaScript file for Casper -->
    <script type="text/javascript" src="/assets/js/index.js"></script>

</body>
</html>

<!DOCTYPE html>
<html>
<head>
    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Page Meta -->
    <title>SSH like a Pro</title>
    <meta name="description" content="A place where I share my thoughts about programming." />

    <!-- Mobile Meta -->
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Brand icon -->
    <link rel="shortcut icon" href="/assets/images/favicon.ico" >

    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css" />

    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!-- Ghost outputs important style and meta data with this tag -->
        <link rel="canonical" href="//ssh-like-a-pro" />
    <meta name="referrer" content="origin" />
    <link rel="next" href="/page2/" />

    <meta property="og:site_name" content="Programming is Magic" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="SSH like a Pro" />
    <meta property="og:description" content="A place where I share my thoughts about programming." />
    <meta property="og:url" content="//ssh-like-a-pro" />
    <meta property="og:image" content="/assets/images/mc_cover9.jpeg" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="SSH like a Pro" />
    <meta name="twitter:description" content="A place where I share my thoughts about programming." />
    <meta name="twitter:url" content="//ssh-like-a-pro" />
    <meta name="twitter:image:src" content="/assets/images/mc_cover9.jpeg" />

    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Website",
    "publisher": "Programming is Magic",
    "name": "SSH like a Pro",
    "url": "//ssh-like-a-pro",
    "image": "/assets/images/mc_cover9.jpeg",
    "description": "A place where I share my thoughts about programming."
}
    </script>

    <meta name="generator" content="Jekyll 3.0.0" />
    <link rel="alternate" type="application/rss+xml" title="Programming is Magic" href="/feed.xml" />


</head>
<body class="home-template nav-closed">

    <!-- The blog navigation links -->
    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        <li class="nav-home " role="presentation"><a href="/">Home</a></li>
        <!-- <li class="nav-about " role="presentation"><a href="/about">About</a></li> -->

        
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/java">
                    java (28)
                    <!-- ssh-like-a-pro name: java -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/dotnet">
                    dotnet (11)
                    <!-- ssh-like-a-pro name: dotnet -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/algorithms">
                    algorithms (7)
                    <!-- ssh-like-a-pro name: algorithms -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/architecture">
                    architecture (7)
                    <!-- ssh-like-a-pro name: architecture -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/scala">
                    scala (7)
                    <!-- ssh-like-a-pro name: scala -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/javascript">
                    javascript (5)
                    <!-- ssh-like-a-pro name: javascript -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/csharp">
                    csharp (4)
                    <!-- ssh-like-a-pro name: csharp -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/polish">
                    polish (4)
                    <!-- ssh-like-a-pro name: polish -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/elektronika">
                    elektronika (3)
                    <!-- ssh-like-a-pro name: elektronika -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/hibernate">
                    hibernate (3)
                    <!-- ssh-like-a-pro name: hibernate -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/linux">
                    linux (3)
                    <!-- ssh-like-a-pro name: linux -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/unit-testing">
                    unit-testing (3)
                    <!-- ssh-like-a-pro name: unit-testing -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/hardware-review">
                    hardware-review (2)
                    <!-- ssh-like-a-pro name: hardware-review -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/cheatsheet">
                    cheatsheet (1)
                    <!-- ssh-like-a-pro name: cheatsheet -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/devcon">
                    devcon (1)
                    <!-- ssh-like-a-pro name: devcon -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/eclipse">
                    eclipse (1)
                    <!-- ssh-like-a-pro name: eclipse -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/functional-programming">
                    functional-programming (1)
                    <!-- ssh-like-a-pro name: functional-programming -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/git">
                    git (1)
                    <!-- ssh-like-a-pro name: git -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/hacking">
                    hacking (1)
                    <!-- ssh-like-a-pro name: hacking -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/hardware">
                    hardware (1)
                    <!-- ssh-like-a-pro name: hardware -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/kotlin">
                    kotlin (1)
                    <!-- ssh-like-a-pro name: kotlin -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/low-level">
                    low-level (1)
                    <!-- ssh-like-a-pro name: low-level -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/other">
                    other (1)
                    <!-- ssh-like-a-pro name: other -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/postman">
                    postman (1)
                    <!-- ssh-like-a-pro name: postman -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/powershell">
                    powershell (1)
                    <!-- ssh-like-a-pro name: powershell -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/regex">
                    regex (1)
                    <!-- ssh-like-a-pro name: regex -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/security">
                    security (1)
                    <!-- ssh-like-a-pro name: security -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/sql">
                    sql (1)
                    <!-- ssh-like-a-pro name: sql -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/ssh">
                    ssh (1)
                    <!-- ssh-like-a-pro name: ssh -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/tips">
                    tips (1)
                    <!-- ssh-like-a-pro name: tips -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/vim">
                    vim (1)
                    <!-- ssh-like-a-pro name: vim -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/windows">
                    windows (1)
                    <!-- ssh-like-a-pro name: windows -->
                </a>
            </li>
        

   </ul>
    <a class="subscribe-button icon-feed" href="/feed.xml">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The comment above "< default" means - insert everything in this file into -->
    <!-- the [body] of the default.hbs template, which contains our header/footer. -->

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->



<header class="main-header post-head " style="background-image: url(/assets/images/mc_cover9.jpeg) ">
    <nav class="main-nav  overlay  clearfix">
        <a class="blog-logo" href="/"><img src="/assets/images/home.png" alt="Blog Logo" /></a>
        
            <a class="menu-button icon-menu" href="#"><span class="word">Menu</span></a>
        
    </nav>
</header>

<main class="content" role="main">

    <article class="post tag-test tag-content">

        <header class="post-header">
            <h1 class="post-title">SSH like a Pro</h1>
            <section class="post-meta">
            <!-- <a href='/'></a> -->

            
                
                    <a href='/author/mc'>Marcin Chwedczuk</a>
                
            
            <time class="post-date" datetime="2020-10-01">01 Oct 2020</time>
                <!-- [[tags prefix=" on "]] -->
                
                on
                
                    
                       <a href='/tag/ssh'>Ssh</a>,
                    
                
                    
                       <a href='/tag/jvmbloggers'>Jvmbloggers</a>
                    
                
                
            </section>
        </header>

        <section class="post-content">

            <p>In this post I have gathered various tips and tricks 
that can make you a more productive SSH user.</p>

<h3 id="copying-ssh-keys-to-the-server">Copying SSH keys to the server</h3>

<p>A lot of beginners when faced with the problem of uploading their
public keys to the server, follows a manual process.
I will demonstrate this, by trying to upload my public key to a Raspberry PI manually:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">mac<span class="nv">$ </span>ssh pi@raspberry_pi
pi@raspberry_pi<span class="s1">'s password:

pi$ mkdir .ssh
pi$ vi .ssh/authorized_keys
pi$ # Append contents of key_rsa.pub to authorized_keys
pi$ ^D # Ctrl-D to end our ssh session</span></code></pre></figure>

<p>Now I can connect to Raspberry PI using my private key:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">mac<span class="nv">$ </span><span class="c"># Let's load the private key so that we can use it</span>
mac<span class="nv">$ </span>ssh-add ~/.ssh/pi_rsa

mac<span class="nv">$ </span>ssh pi@raspberry_pi
pi<span class="nv">$ </span><span class="c"># Yay!</span></code></pre></figure>

<p>I was lucky - in my case everything worked, but often it doesn’t.
The main culprit is usually a wrong access permission set either on <code class="highlighter-rouge">.ssh</code> directory
or on <code class="highlighter-rouge">authorized_keys</code> file.
Here is how the right permissions should look like:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">pi@raspberrypi:~ <span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span> .ssh
total 12
drwx------  2 pi pi 4096 Oct  1 10:09 <span class="nb">.</span>
drwxr-xr-x 17 pi pi 4096 Oct  1 10:09 ..
<span class="nt">-rw-------</span>  1 pi pi  574 Oct  1 10:09 authorized_keys</code></pre></figure>

<p>PROs do not think about permissions, nor they manually edit <code class="highlighter-rouge">authorized_keys</code> file.
Instead they use <code class="highlighter-rouge">ssh-copy-id</code> util (a part of the official SSH distribution).</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">mac<span class="nv">$ </span>ssh pi@raspberry_pi <span class="s1">'rm -rf ~/.ssh'</span> <span class="c"># Let's reset everything</span>
mac<span class="nv">$ </span>ssh-copy-id <span class="nt">-i</span> ~/.ssh/pi_rsa pi@raspberry_pi

mac<span class="nv">$ </span>ssh-add ~/.ssh/pi_rsa <span class="c"># Do not forget to load the key</span>
mac<span class="nv">$ </span>ssh pi@raspberry_pi
pi<span class="nv">$ </span><span class="c"># Yay!</span></code></pre></figure>

<p>One nice thing about <code class="highlighter-rouge">ssh-copy-id</code> is that it always uploads the public key,
even if you (like I in the above example) specify private key file on the command line.</p>

<h3 id="keys-management">Keys management</h3>

<p><code class="highlighter-rouge">ssh-add</code> is a nice utility that manages currently active (loaded) private keys.
Loaded keys can be automatically used for authentication.</p>

<p>To load a key type:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># ssh-add path-to-key-file</span>
mac<span class="nv">$ </span>ssh-add ~/.ssh/pi_rsa</code></pre></figure>

<p>Or just <code class="highlighter-rouge">ssh-add</code> to load <code class="highlighter-rouge">id_rsa</code>.</p>

<p>To list currently loaded keys:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>ssh-add <span class="nt">-l</span></code></pre></figure>

<p>To remove all keys:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>ssh-add <span class="nt">-D</span></code></pre></figure>

<p>When you connect to a remote machine you have an option to pass your currently
loaded keys along. This is called ssh agent forwarding and 
allows you to ssh into further machines using your private keys:</p>

<p><img src="assets/images/2020-10-01/ssh1.svg" alt="Nested SSH connections" /></p>

<p>For example without key forwarding I cannot log from my Raspberry PI into my PC:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">mac<span class="nv">$ </span>ssh pi@raspberry_pi
pi<span class="nv">$ </span>ssh mc@old-pc 
Password:</code></pre></figure>

<p>With key forwarding enabled (<code class="highlighter-rouge">-A</code>) I can:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">mac<span class="nv">$ </span>ssh <span class="nt">-A</span> pi@raspberry_pi
pi<span class="nv">$ </span>ssh mc@old-pc
old-pc<span class="nv">$ </span><span class="c"># yay!</span></code></pre></figure>

<p>WARNING: You should only use forwarding when logging into servers that
you fully trust (see <code class="highlighter-rouge">man ssh</code> for details).</p>

<p>TIP: With the power of <code class="highlighter-rouge">ssh-add</code> there is no reason to have a key without password protection.
Remember to password protect all your keys. Always!</p>

<h3 id="using-sshconfig">Using ~/.ssh/config</h3>

<p>Sometimes your user name is too long or hard to remember or maybe the server name is
or maybe your server uses a non-standard SSH port. Any of these can make typing the right ssh command
in the terminal very hard. But there is a nice solution to this, 
we just need to add an entry for our server to <code class="highlighter-rouge">~/.ssh/config</code> file.</p>

<p>For example for my Raspberry PI computer I added the following entry:</p>

<figure class="highlight"><pre><code class="language-no-highlight" data-lang="no-highlight"># this is comment
Host pi
        Hostname raspberry_pi
        Port 22
        User pi
        IdentityFile ~/.ssh/pi_rsa
        ForwardAgent yes
        # or ForwardAgent no</code></pre></figure>

<p>Now I can ssh into it by simply typing:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">mac<span class="nv">$ </span>ssh pi
pi<span class="nv">$ </span><span class="c"># yay!</span></code></pre></figure>

<h3 id="copying-files">Copying files</h3>

<p><code class="highlighter-rouge">scp</code> command may be used to copy files, both from a server to the local machine:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Assumes that we use pi alias</span>
mac<span class="nv">$ </span>scp pi:./myfile.txt <span class="nb">.</span> 
<span class="c"># Without pi alias </span>
mac<span class="nv">$ </span>scp <span class="nt">-P22</span> pi@raspberry_pi:./myfile.txt ./myfile.txt</code></pre></figure>

<p>Or from the local machine to the server:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Assumes that we use pi alias</span>
mac<span class="nv">$ </span>scp map.txt pi:./map2.txt
<span class="c"># Without pi alias</span>
mac<span class="nv">$ </span>scp <span class="nt">-P22</span> map.txt pi@raspberry_pi:./
<span class="c"># You may skip -P parameter if server is using default (22) port</span></code></pre></figure>

<p>TIP: If are going to transfer a big file remember to <code class="highlighter-rouge">gzip</code> it first.</p>

<p>For more complex scenarios we can use either <code class="highlighter-rouge">sftp</code> command:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">mac<span class="nv">$ </span>sftp pi
Connected to pi.
sftp&gt; <span class="nb">ls</span> <span class="c"># list files on the *server*</span>
Bookshelf   Desktop     Documents   Downloads   Music       Pictures    Public
Templates   Videos      server_file.txt
sftp&gt; get server_file.txt ./save_as_downloaded.txt
Fetching /home/pi/server_file.txt to ./save_as_downloaded.txt

sftp&gt; put ./local_file.txt ./uploaded.txt
Uploading ./local_file.txt to /home/pi/./uploaded.txt

sftp&gt; <span class="nb">exit</span></code></pre></figure>

<p>or use command line file manager like <code class="highlighter-rouge">mc</code> (Midnight Commander):</p>

<ol>
  <li>Press <code class="highlighter-rouge">F9</code> to select menu bar and <code class="highlighter-rouge">R</code> to expand <code class="highlighter-rouge">Right</code> menu.</li>
  <li>Select <code class="highlighter-rouge">SFTP link...</code></li>
  <li>Enter the connection URL:</li>
</ol>

<p><img src="assets/images/2020-10-01/mc2.png" alt="MC without alias" /></p>

<p>And then you may use standard <code class="highlighter-rouge">mc</code> commands to copy/move/modify files
on the server and the local machine.</p>

<p>To exit SFTP mode just enter <code class="highlighter-rouge">..</code> in the top directory to which you <code class="highlighter-rouge">sftp</code>ed.</p>

<h3 id="port-forwarding">Port forwarding</h3>

<p>Let’s say that there there is a service running on my Raspberry PI that is accessible only
via <code class="highlighter-rouge">localhost</code>. For example it can be a simple web server:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">pi<span class="nv">$ </span>python3 <span class="nt">-m</span> http.server 7777 <span class="nt">--bind</span> 127.0.0.1 <span class="nt">--directory</span> .</code></pre></figure>

<p>Because server is listening only on <code class="highlighter-rouge">127.0.0.1</code> instead of <code class="highlighter-rouge">0.0.0.0</code>, 
we cannot access it from outside of my Raspberry PI:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">mac<span class="nv">$ </span>curl raspberry_pi:7777
curl: <span class="o">(</span>7<span class="o">)</span> Failed to connect to raspberry_pi port 7777: Connection refused</code></pre></figure>

<p>To access the server we may e.g. forward connections to port 5432 on my laptop
to port 7777 on pi (this is called tunneling or port forwarding).
We can do this using SSH:
<img src="assets/images/2020-10-01/tunnel.png" alt="SSH Tunnel" /></p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">mac<span class="nv">$ </span>ssh <span class="nt">-L</span> localhost:5432:localhost:7777 pi
<span class="c"># In another terminal</span>
mac<span class="nv">$ </span>curl localhost:5432
&lt;html&gt;
	&lt;head&gt;&lt;/head&gt;
	&lt;body&gt;
		Welcome on Raspberry PI!!!
	&lt;/body&gt;
&lt;/html&gt;</code></pre></figure>

<p>The general syntax is <code class="highlighter-rouge">-L local-machine:local-port:remote-machine:remote-port</code>.
Notice that for the <code class="highlighter-rouge">remote-machine</code> we have chosen <code class="highlighter-rouge">localhost</code>, but we could e.g.
chose other computer to which <code class="highlighter-rouge">pi</code> can connect. 
<code class="highlighter-rouge">local-machine</code> part can be omitted (<code class="highlighter-rouge">localhost</code> is the default).</p>

<p>If you don’t need the SSH session only the tunnel, you can run <code class="highlighter-rouge">ssh</code> as a background task
(this will not be a shell background task, so it will not show up in <code class="highlighter-rouge">bg</code> command):</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">mac<span class="nv">$ </span>ssh <span class="nt">-fN</span> <span class="nt">-L</span> localhost:5432:localhost:7777 pi
mac<span class="nv">$ </span>ps | <span class="nb">grep </span>ssh
84851 ttys001    0:00.01 <span class="nb">grep </span>ssh
84290 ttys002    0:00.15 ssh pi</code></pre></figure>

<p>Port forwarding can also work in the opposite direction. We may make a service running on
my laptop accessible on Raspberry PI:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">mac<span class="nv">$ </span>python3 <span class="nt">-m</span> http.server 9999 <span class="nt">--bind</span> 127.0.0.1 <span class="nt">--directory</span> <span class="nb">.</span>

<span class="c"># On PI</span>
pi<span class="nv">$ $ </span>curl localhost:5432
curl: <span class="o">(</span>7<span class="o">)</span> Failed to connect to localhost port 5432: Connection refused

<span class="c"># On Mac</span>
mac<span class="nv">$ </span>ssh <span class="nt">-R</span> localhost:5432:localhost:9999 pi
pi<span class="nv">$ </span>curl localhost:5432
&lt;html&gt;
	&lt;head&gt;&lt;/head&gt;
	&lt;body&gt;
		Hello from MacOS!!!
	&lt;/body&gt;
&lt;/html&gt;</code></pre></figure>

<p>Here syntax is <code class="highlighter-rouge">-R remote-machine:remote-port:local-machine:local-port</code>.
Connections to <code class="highlighter-rouge">remote-machine:remote-port</code> are forwarded to <code class="highlighter-rouge">local-machine:local-port</code>.</p>

<p>By default the open ports are available on <code class="highlighter-rouge">localhost</code> only (think security!).
If you want to accept connections from outside, you need to change 
<code class="highlighter-rouge">GatewayPorts</code> settings of sshd daemon to <code class="highlighter-rouge">yes</code> on the server (the machine to which you connect to):</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">pi<span class="nv">$ </span><span class="nb">sudo </span>vi /etc/ssh/sshd_config
<span class="c"># Set GatewayPorts yes</span>
pi<span class="nv">$ </span><span class="nb">sudo </span>service sshd restart</code></pre></figure>

<p>Now we can make <code class="highlighter-rouge">pi</code> accept connection from the entire local network and
forward them to my laptop:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Establish tunnel</span>
mac<span class="nv">$ </span>ssh <span class="nt">-R</span> <span class="s1">'*:5432:localhost:9999'</span> pi
<span class="c"># From my PC</span>
old-pc<span class="nv">$ </span>curl raspberry_pi:5432
&lt;html&gt;
	&lt;head&gt;&lt;/head&gt;
	&lt;body&gt;
		Hello from MacOS!!!
	&lt;/body&gt;
&lt;/html&gt;</code></pre></figure>

<p>TIP: The single quotes are needed to prevent shell expansion of <code class="highlighter-rouge">*</code>.</p>

<h3 id="providing-internet-connection-via-ssh">Providing internet connection via SSH</h3>

<p>Say on your local machine you cannot access e.g. <code class="highlighter-rouge">facebook.com</code> for some strange reason.
But you noticed that on a certain server there is no such restriction,
and you can e.g. use <code class="highlighter-rouge">links</code> to browse <code class="highlighter-rouge">facebook.com</code>:
<img src="assets/images/2020-10-01/fcrap.png" alt="Facebook in Links" />
Since FB does not looks good in <code class="highlighter-rouge">links</code> you really need a better solution…</p>

<p>Behold, SSH comes to the rescue. By using a dynamic port forwarding we may establish
SOCKS tunnel to the server:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">mac<span class="nv">$ </span>ssh <span class="nt">-C</span> <span class="nt">-D</span> 1080 pi </code></pre></figure>

<p><code class="highlighter-rouge">-C</code> is for compression, <code class="highlighter-rouge">1080</code> is the standard SOCKS port.</p>

<p>Now we need to configure a browser. Firefox is well known for excellent SOCKS support:
<img src="assets/images/2020-10-01/ff.png" alt="SOCKS proxy configuration in Firefox" />
And voilà <code class="highlighter-rouge">facebook.com</code> is working again!</p>

<p>A trick like this was very popular when I was living in a dormitory.
Our dorm internet connection was very slow, but as CS students we had SSH access
to a few servers, some of them with very fast internet connections…</p>

<h3 id="x-forwarding">X Forwarding</h3>

<p>Here I will explain how to do this on MacOS.
First we need to install <a href="https://www.xquartz.org/">XQuartz</a>, which is X11
port for MacOS:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">mac<span class="nv">$ </span>brew install xquartz</code></pre></figure>

<p>Next we need to start XQuartz.app (it will only show in the dock).</p>

<p>Now we must enable X11 forwarding support on Raspberry PI:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">pi<span class="nv">$ </span><span class="nb">sudo </span>vi /etc/ssh/sshd_config
<span class="c"># Set: </span>
<span class="c"># X11Forwarding yes</span>
<span class="c"># X11DisplayOffset 10</span>
pi<span class="nv">$ </span><span class="nb">sudo </span>service sshd restart
pi<span class="nv">$ </span>which xauth <span class="c"># Make sure xauth is installed</span></code></pre></figure>

<p>And finally we can start our X session:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">mac<span class="nv">$ DISPLAY</span><span class="o">=</span>:0 ssh <span class="nt">-X</span> pi
pi<span class="nv">$ </span>vlc</code></pre></figure>

<p>Now when I typed <code class="highlighter-rouge">vlc</code> a VLC window popped up on my laptop. 
The resolution isn’t great (it would look native if I used X11 port forwarding on Linux), 
this is due to poor retina display support in XQuartz. But still it works:
<img src="assets/images/2020-10-01/vlc.png" alt="XForwarding in MacOS" /></p>

<h3 id="tmux-session-manager">Tmux session manager</h3>

<p>Sometimes you want to leave some program running on the server even if you close
you SSH connection. Or maybe you are doing something important, e.g. devops stuff and
you want to make sure that the command you are executing will not be interrupted.
For cases like this (…and for hacker movie lovers) terminal multiplexers where invented.
The two most popular ones are <code class="highlighter-rouge">screen</code> and <code class="highlighter-rouge">tmux</code>.</p>

<p>Here I will shortly explain what <code class="highlighter-rouge">tmux</code> is. 
Generally <code class="highlighter-rouge">tmux</code> deserves its own blog post,
fortunately for me <a href="https://www.hamvocke.com/blog/a-quick-and-easy-guide-to-tmux/">this post is already written</a>.
Here I will only show you one single use-case, just to give you the taste what <code class="highlighter-rouge">tmux</code> is all about.</p>

<p>Let’s connect to Raspberry PI and start <code class="highlighter-rouge">vi</code> inside <code class="highlighter-rouge">tmux</code> session:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">pi<span class="nv">$ </span>tmux
pi <span class="o">[</span>tmux]<span class="nv">$ </span>vi
<span class="c"># Some serious editing</span></code></pre></figure>

<p>Next I will perform some manual intervention (the physical connection got busted):
<img src="assets/images/2020-10-01/pi.jpeg" alt="Simulating connection link failure" />
My SSH session on my laptop hanged so I had to kill it with <code class="highlighter-rouge">pkill ssh</code>.</p>

<p>Now after I fixed the Ethernet connection and reconnected to <code class="highlighter-rouge">pi</code> 
I can execute <code class="highlighter-rouge">tmux ls</code> and see my previous
session:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">pi<span class="nv">$ </span>tmux <span class="nb">ls
</span>0: 1 windows <span class="o">(</span>created Thu Oct  1 15:00:01 2020<span class="o">)</span> <span class="o">[</span>90x43]</code></pre></figure>

<p>Let’s attach tmux to this session:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">pi<span class="nv">$ </span>tmux attach <span class="nt">-t</span> 0
<span class="c"># Bang! my VI is back with all the unsaved text</span></code></pre></figure>

<p>Looks like after attaching I could recover all my previous work!</p>

<p>WARNING: <code class="highlighter-rouge">tmux</code> session will not survive the server restart. Make sure that the server
will not be restarted while running important computations within <code class="highlighter-rouge">tmux</code>.</p>

<p>Congrats! Now you are SSH PRO!</p>

<h3 id="references">References</h3>

<ul>
  <li>https://www.cyberciti.biz/faq/create-ssh-config-file-on-linux-unix/</li>
  <li>http://www.trembath.co.za/mctutorial.html</li>
  <li>https://phoenixnap.com/kb/ssh-port-forwarding</li>
  <li>https://help.ubuntu.com/community/SSH/OpenSSH/PortForwarding</li>
  <li>https://linuxize.com/post/how-to-setup-ssh-socks-tunnel-for-private-browsing/</li>
  <li>https://unix.stackexchange.com/a/46748</li>
</ul>


        </section>

        <footer class="post-footer">

            <!-- Everything inside the #author tags pulls data from the author -->
            <!-- #author-->
            
                
                    
                        <figure class="author-image">
                            <a class="img" href="/author/mc" style="background-image: url(/assets/images/mc.png)"><span class="hidden">mc's Picture</span></a>
                        </figure>
                    

                    <section class="author">
                        <h4><a href="/author/mc">Marcin Chwedczuk</a></h4>

                        
                            <p> A programmer, a geek, a human</p>
                        
                        <div class="author-meta">
                            <span class="author-location icon-location"> Warsaw, Poland</span>
                            <span class="author-link icon-link"><a href="http://marcinchwedczuk.pl"> http://marcinchwedczuk.pl</a></span>
                        </div>
                    </section>

                    <!-- /author  -->

                    <section class="share">
                        <h4>Share this post</h4>
                        <a class="icon-twitter" href="http://twitter.com/share?text=SSH like a Pro&amp;url=ssh-like-a-pro"
                            onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                            <span class="hidden">Twitter</span>
                        </a>
                        <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=ssh-like-a-pro"
                            onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                            <span class="hidden">Facebook</span>
                        </a>
                        <a class="icon-google-plus" href="https://plus.google.com/share?url=ssh-like-a-pro"
                           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                            <span class="hidden">Google+</span>
                        </a>
                    </section>
                
            

            <!-- Add Disqus Comments -->
            
                <div id="disqus_thread"></div>
<script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'marcinchwedczukgithubio'; // required: replace example with your forum shortname
        var disqus_identifier = '/ssh-like-a-pro';
        var disqus_url = '/ssh-like-a-pro';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>

            

        </footer>

    </article>

</main>

<aside class="read-next">

    <!-- [[! next_post ]] -->
    
    <!-- [[! /next_post ]] -->
    <!-- [[! prev_post ]] -->
    
        <a class="read-next-story prev " style="background-image: url(/assets/images/mc_cover6.jpg)" href="/minikomputer-8085-czesc-II">
            <section class="post">
                <h2>Minikomputer 8085 - Część II</h2>
                <p>W poprzednim wpisie udało nam się zbudować działający minikomputer oraz uruchomić na nim napisany przez...</p>
            </section>
        </a>
    
    <!-- [[! /prev_post ]] -->
</aside>

<!-- /post -->


        <!-- The tiny footer at the very bottom -->
        <footer class="site-footer clearfix">
          <section class="copyright"><a href="/">Programming is Magic</a> &copy; 2020</section>
          <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> using <a href="https://github.com/jekyller/jasper">Jasper</a></section>
        </footer>
    </div>
    <!-- highlight.js -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- jQuery needs to come before `` so that jQuery can be used in code injection -->
    <script type="text/javascript" src="//code.jquery.com/jquery-1.12.0.min.js"></script>
    <!-- Ghost outputs important scripts and data with this tag -->
    <!--  -->
    <!-- Add Google Analytics  -->
        <!-- Google Analytics Tracking code -->
     <script>
	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	    ga('create', 'UA-82096342-1', 'auto');
	    ga('send', 'pageview');

     </script>
    <!-- Fitvids makes video embeds responsive and awesome -->
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <!-- The main JavaScript file for Casper -->
    <script type="text/javascript" src="/assets/js/index.js"></script>

</body>
</html>

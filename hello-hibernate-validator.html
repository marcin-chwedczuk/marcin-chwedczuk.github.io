<!DOCTYPE html>
<html>
<head>
    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Page Meta -->
    <title>Hello, Hibernate Validator</title>
    <meta name="description" content="A place where I share my thoughts about programming." />

    <!-- Mobile Meta -->
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Brand icon -->
    <link rel="shortcut icon" href="/assets/images/favicon.ico" >

    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css" />

    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!-- Ghost outputs important style and meta data with this tag -->
        <link rel="canonical" href="http://localhost:4000//hello-hibernate-validator" />
    <meta name="referrer" content="origin" />
    <link rel="next" href="/page2/" />

    <meta property="og:site_name" content="Programming is Magic" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Hello, Hibernate Validator" />
    <meta property="og:description" content="A place where I share my thoughts about programming." />
    <meta property="og:url" content="http://localhost:4000//hello-hibernate-validator" />
    <meta property="og:image" content="/assets/images/mc_cover2.jpg" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Hello, Hibernate Validator" />
    <meta name="twitter:description" content="A place where I share my thoughts about programming." />
    <meta name="twitter:url" content="http://localhost:4000//hello-hibernate-validator" />
    <meta name="twitter:image:src" content="/assets/images/mc_cover2.jpg" />

    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Website",
    "publisher": "Programming is Magic",
    "name": "Hello, Hibernate Validator",
    "url": "http://localhost:4000//hello-hibernate-validator",
    "image": "/assets/images/mc_cover2.jpg",
    "description": "A place where I share my thoughts about programming."
}
    </script>

    <meta name="generator" content="Jekyll 3.0.0" />
    <link rel="alternate" type="application/rss+xml" title="Programming is Magic" href="/feed.xml" />


</head>
<body class="home-template nav-closed">

    <!-- The blog navigation links -->
    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        <li class="nav-home " role="presentation"><a href="/">Home</a></li>
        <!-- <li class="nav-about " role="presentation"><a href="/about">About</a></li> -->

        
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/java">
                    java (28)
                    <!-- hello-hibernate-validator name: java -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/dotnet">
                    dotnet (11)
                    <!-- hello-hibernate-validator name: dotnet -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/algorithms">
                    algorithms (7)
                    <!-- hello-hibernate-validator name: algorithms -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/architecture">
                    architecture (7)
                    <!-- hello-hibernate-validator name: architecture -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/javascript">
                    javascript (5)
                    <!-- hello-hibernate-validator name: javascript -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/csharp">
                    csharp (4)
                    <!-- hello-hibernate-validator name: csharp -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/scala">
                    scala (4)
                    <!-- hello-hibernate-validator name: scala -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/hibernate">
                    hibernate (3)
                    <!-- hello-hibernate-validator name: hibernate -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/linux">
                    linux (3)
                    <!-- hello-hibernate-validator name: linux -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/unit-testing">
                    unit-testing (3)
                    <!-- hello-hibernate-validator name: unit-testing -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/hardware-review">
                    hardware-review (2)
                    <!-- hello-hibernate-validator name: hardware-review -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/cheatsheet">
                    cheatsheet (1)
                    <!-- hello-hibernate-validator name: cheatsheet -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/devcon">
                    devcon (1)
                    <!-- hello-hibernate-validator name: devcon -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/eclipse">
                    eclipse (1)
                    <!-- hello-hibernate-validator name: eclipse -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/elektronika">
                    elektronika (1)
                    <!-- hello-hibernate-validator name: elektronika -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/functional-programming">
                    functional-programming (1)
                    <!-- hello-hibernate-validator name: functional-programming -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/git">
                    git (1)
                    <!-- hello-hibernate-validator name: git -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/hacking">
                    hacking (1)
                    <!-- hello-hibernate-validator name: hacking -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/hardware">
                    hardware (1)
                    <!-- hello-hibernate-validator name: hardware -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/kotlin">
                    kotlin (1)
                    <!-- hello-hibernate-validator name: kotlin -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/low-level">
                    low-level (1)
                    <!-- hello-hibernate-validator name: low-level -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/other">
                    other (1)
                    <!-- hello-hibernate-validator name: other -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/polish">
                    polish (1)
                    <!-- hello-hibernate-validator name: polish -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/postman">
                    postman (1)
                    <!-- hello-hibernate-validator name: postman -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/powershell">
                    powershell (1)
                    <!-- hello-hibernate-validator name: powershell -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/regex">
                    regex (1)
                    <!-- hello-hibernate-validator name: regex -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/security">
                    security (1)
                    <!-- hello-hibernate-validator name: security -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/sql">
                    sql (1)
                    <!-- hello-hibernate-validator name: sql -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/tips">
                    tips (1)
                    <!-- hello-hibernate-validator name: tips -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/vim">
                    vim (1)
                    <!-- hello-hibernate-validator name: vim -->
                </a>
            </li>
        
            
            
            <li class="nav-about " role="presentation">
                <a href="/tag/windows">
                    windows (1)
                    <!-- hello-hibernate-validator name: windows -->
                </a>
            </li>
        

   </ul>
    <a class="subscribe-button icon-feed" href="/feed.xml">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The comment above "< default" means - insert everything in this file into -->
    <!-- the [body] of the default.hbs template, which contains our header/footer. -->

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->



<header class="main-header post-head " style="background-image: url(/assets/images/mc_cover2.jpg) ">
    <nav class="main-nav  overlay  clearfix">
        <a class="blog-logo" href="/"><img src="/assets/images/home.png" alt="Blog Logo" /></a>
        
            <a class="menu-button icon-menu" href="#"><span class="word">Menu</span></a>
        
    </nav>
</header>

<main class="content" role="main">

    <article class="post tag-test tag-content">

        <header class="post-header">
            <h1 class="post-title">Hello, Hibernate Validator</h1>
            <section class="post-meta">
            <!-- <a href='/'></a> -->

            
                
                    <a href='/author/mc'>Marcin Chwedczuk</a>
                
            
            <time class="post-date" datetime="2017-02-05">05 Feb 2017</time>
                <!-- [[tags prefix=" on "]] -->
                
                on
                
                    
                       <a href='/tag/java'>Java</a>
                    
                
                
            </section>
        </header>

        <section class="post-content">

            <p>In every enterprise application there is a need for
validation. You may want to validate data send by user to
your REST service, messages coming to your application from some
other system, or your own entities before saving them to database.</p>

<p>Standard
<a href="http://beanvalidation.org/1.0/spec">JSR 303</a>
defines API for validating Java Beans without tying us to any
particular implementation.
Nevertheless some implementations are more polished than others,
and subject of this post -
Hibernate Validator is considered one of the best.</p>

<h4 id="project-setup">Project setup</h4>

<p>Before we can use Hibernate Validator we must do
some groundwork.</p>

<h5 id="maven-dependencies">Maven dependencies</h5>

<p>To use Hibernate Validator we need following Maven dependencies:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.hibernate<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>hibernate-validator<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>5.3.4.Final<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>javax.el<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>el-api<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>2.2<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.glassfish.web<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>javax.el<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>RELEASE<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure>

<p>Hibernate Validator uses Java Unified Expression Language (JavaEL)
to format validation messages. When your application runs
inside JEE container, container already provides JavaEL 
implementation.
Since we want to create a command line application we must provide 
JavaEL implementation ourselves and that’s the reason
why we included <code class="highlighter-rouge">javax.el:el-api</code> and <code class="highlighter-rouge">org.glassfish.web:javax.el</code> as
dependencies.</p>

<p>Later on to demonstrate all features of Hibernate Validator we will need
Spring DI container and <code class="highlighter-rouge">commons-beanutils</code> library:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>commons-beanutils<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>commons-beanutils<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.9.3<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-context<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>4.3.5.RELEASE<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure>

<h5 id="obtaining-validator-instance">Obtaining <code class="highlighter-rouge">Validator</code> instance</h5>

<p>After all these preparations we are ready to create <code class="highlighter-rouge">Validator</code>
instance:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">javax.validation.Validation</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.Validator</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Validator</span> <span class="n">validator</span> <span class="o">=</span> <span class="n">Validation</span>
                              <span class="o">.</span><span class="na">buildDefaultValidatorFactory</span><span class="o">()</span>
                              <span class="o">.</span><span class="na">getValidator</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

<p>Note that we don’t have any reference to Hibernate Validator in
our code, instead we are relying on classes and interfaces defined in
JSR 303 (Bean Validation).
This is very similar to how JDBC providers works.</p>

<p>Returned <code class="highlighter-rouge">Validator</code> instance is thread safe and may be assigned to
static field or registered as a singleton in DI container for later use.</p>

<h4 id="validating-beans">Validating beans</h4>

<h5 id="property-level-constraints">Property level constraints</h5>

<p>The easiest way to define validation rules for a bean
is to use JSR 303 annotations.
We may put annotations on both fields and getters, for example:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
    <span class="nd">@NotNull</span>           
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
<span class="o">}</span>
<span class="c1">// or:</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
    <span class="nd">@NotNull</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>             
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>                      
    <span class="o">}</span>                                     
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>    
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>                 
    <span class="o">}</span>                                     
<span class="o">}</span></code></pre></figure>

<p>We should prefer putting annotations on getters since this will
allow for greater flexibility when later we will want to
change our beans.
Said that, to conserve space in this post I will
put annotations on fields from now on.</p>

<p>Here is a simple bean representing a person,
annotated with JSR 303 constraints:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
    <span class="nd">@NotNull</span>
    <span class="nd">@Length</span><span class="o">(</span><span class="n">min</span><span class="o">=</span><span class="mi">1</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="nd">@NotNull</span>
    <span class="nd">@Length</span><span class="o">(</span><span class="n">min</span><span class="o">=</span><span class="mi">1</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">surname</span><span class="o">;</span>

    <span class="nd">@Range</span><span class="o">(</span><span class="n">min</span><span class="o">=</span><span class="mi">1</span><span class="o">,</span> <span class="n">max</span><span class="o">=</span><span class="mi">200</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>
  
    <span class="c1">// getters, setters </span>
<span class="o">}</span></code></pre></figure>

<p>Validation rules should be self evident. There is nothing fancy -
we check that a person must have a non empty name and a non empty
surname, and that an age of a person falls within a range of 1 and 200.</p>

<p>Then we may use Hibernate Validator to check if 
a <code class="highlighter-rouge">Person</code> instance is valid:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Validator</span> <span class="n">validator</span> <span class="o">=</span> <span class="n">Validation</span>
       <span class="o">.</span><span class="na">buildDefaultValidatorFactory</span><span class="o">()</span>
       <span class="o">.</span><span class="na">getValidator</span><span class="o">();</span>

<span class="n">Person</span> <span class="n">joe</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person</span><span class="o">();</span>
<span class="n">joe</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Joe"</span><span class="o">);</span>
<span class="n">joe</span><span class="o">.</span><span class="na">setSurname</span><span class="o">(</span><span class="s">"Doe"</span><span class="o">);</span>
<span class="n">joe</span><span class="o">.</span><span class="na">setAge</span><span class="o">(</span><span class="mi">43</span><span class="o">);</span>

<span class="n">Set</span><span class="o">&lt;</span><span class="n">ConstraintViolation</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;&gt;</span> <span class="n">constraintViolations</span> <span class="o">=</span>
       <span class="n">validator</span><span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="n">joe</span><span class="o">);</span>

<span class="k">assert</span> <span class="n">constraintViolations</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">;</span> <span class="c1">// yeah, no errors</span></code></pre></figure>

<p>In rare cases when <code class="highlighter-rouge">Person</code> is invalid, Hibernate Validator
provides us with all necessary information about what
properties and values are wrong:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Person</span> <span class="n">joe</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person</span><span class="o">();</span>
<span class="n">joe</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
<span class="n">joe</span><span class="o">.</span><span class="na">setSurname</span><span class="o">(</span><span class="s">"Doe"</span><span class="o">);</span>
<span class="n">joe</span><span class="o">.</span><span class="na">setAge</span><span class="o">(</span><span class="mi">1024</span><span class="o">);</span>

<span class="n">Set</span><span class="o">&lt;</span><span class="n">ConstraintViolation</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;&gt;</span> <span class="n">constraintViolations</span> <span class="o">=</span>
       <span class="n">validator</span><span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="n">joe</span><span class="o">);</span>

<span class="k">for</span> <span class="o">(</span><span class="n">ConstraintViolation</span><span class="o">&lt;?&gt;</span> <span class="nl">violation:</span> <span class="n">constraintViolations</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%10s | %30s | is %10s%n"</span><span class="o">,</span>
           <span class="n">violation</span><span class="o">.</span><span class="na">getPropertyPath</span><span class="o">(),</span>
           <span class="n">violation</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(),</span>
           <span class="n">violation</span><span class="o">.</span><span class="na">getInvalidValue</span><span class="o">()</span>
           <span class="o">);</span>
<span class="o">}</span>
<span class="c1">// OUTPUT:</span>
<span class="c1">//       age |      must be between 1 and 200 | is       1024</span>
<span class="c1">//      name |                may not be null | is       null</span></code></pre></figure>

<h5 id="bean-level-constraints">Bean level constraints</h5>

<p>Some validation rules may be expressed only by using
values of two or more properties, for such rules 
Hibernate Validator provides class-level constrains.
Returning to our <code class="highlighter-rouge">Person</code> example, suppose that we want to add
two new properties to <code class="highlighter-rouge">Person</code>: <code class="highlighter-rouge">dateOfBirth</code> and <code class="highlighter-rouge">dateOfDeath</code>, with
condition that <code class="highlighter-rouge">dateOfBirth</code> cannot be later than <code class="highlighter-rouge">dateOfDeath</code>
(when both dates are present):</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
    <span class="nd">@NotNull</span>
    <span class="kd">private</span> <span class="n">LocalDate</span> <span class="n">dateOfBirth</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">LocalDate</span> <span class="n">dateOfDeath</span><span class="o">;</span>
    
    <span class="c1">// ...</span>
<span class="o">}</span></code></pre></figure>

<p>We can express our rule using proprietary (not included in JSR 303)
class-level <code class="highlighter-rouge">@ScriptAssert</code> annotation:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">org.hibernate.validator.constraints.ScriptAssert</span><span class="o">;</span>

<span class="nd">@ScriptAssert</span><span class="o">(</span><span class="n">lang</span> <span class="o">=</span> <span class="s">"javascript"</span><span class="o">,</span>
        <span class="n">script</span><span class="o">=</span><span class="s">"_.dateOfBirth == null || _.dateOfDeath == null || _.dateOfBirth &lt;= _.dateOfDeath"</span><span class="o">,</span>
        <span class="n">alias</span><span class="o">=</span><span class="s">"_"</span><span class="o">,</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s">"date of death cannot be before date of birth"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
   <span class="c1">// ...</span>
<span class="o">}</span> </code></pre></figure>

<p>Here I decided to use JavaScript scripting engine (<code class="highlighter-rouge">lang = "javascript"</code>)
because it
is already shipped with Java SE, moreover JavaScript syntax should be
familiar to any Java developer. Hibernate Validator supports
any implementation adhering to JSR 223 standard
(scripting for the Java platform).</p>

<p>JavaScript expression used as value of <code class="highlighter-rouge">script</code> argument:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">_</span><span class="p">.</span><span class="nx">dateOfBirth</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> 
   <span class="nx">_</span><span class="p">.</span><span class="nx">dateOfDeath</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> 
   <span class="nx">_</span><span class="p">.</span><span class="nx">dateOfBirth</span> <span class="o">&lt;=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">dateOfDeath</span></code></pre></figure>

<p>must <em>always</em> return either <code class="highlighter-rouge">true</code> when validation rule is
fullfiled or <code class="highlighter-rouge">false</code>.
We must also take care of handling <code class="highlighter-rouge">null</code> values otherwise we may
get pesky <code class="highlighter-rouge">javax.script.ScriptException</code>.</p>

<p>Inside <code class="highlighter-rouge">script</code> we may refer to currently validated bean by name of <code class="highlighter-rouge">_this</code>,
or by name of our choosing if we set <code class="highlighter-rouge">alias</code> argument like we do in
our example.</p>

<p><code class="highlighter-rouge">@ScriptAssert</code> is a duct tape of validation. You should
use it only when performance is not a concern, and you must
provide a solution quickly. In most cases you should prefer
to write you own constraint and validator. Anyway <code class="highlighter-rouge">@ScriptAssert</code> is
a great example of class-level constraint.</p>

<h5 id="validating-child-beans">Validating child beans</h5>

<p>To demonstrate parent-child bean validation we will
add <code class="highlighter-rouge">Address</code> to <code class="highlighter-rouge">Person</code> class.
<code class="highlighter-rouge">Address</code> will be optional so not every <code class="highlighter-rouge">Person</code> instance will have one,
we only require that if a <code class="highlighter-rouge">Person</code> has an address it must be a
valid one.
<code class="highlighter-rouge">Address</code> will be represented by the following bean:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Address</span> <span class="o">{</span>
    <span class="nd">@NotBlank</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">street</span><span class="o">;</span>

    <span class="nd">@NotBlank</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">zipCode</span><span class="o">;</span>

    <span class="nd">@NotBlank</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">city</span><span class="o">;</span>

    <span class="c1">// getter,setters</span>
<span class="o">}</span></code></pre></figure>

<p>Also we must add <code class="highlighter-rouge">address</code> property to <code class="highlighter-rouge">Person</code> bean:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
    <span class="nd">@Valid</span>
    <span class="kd">private</span> <span class="n">Address</span> <span class="n">address</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure>

<p><code class="highlighter-rouge">@Valid</code> annotation that we put on <code class="highlighter-rouge">address</code> field
tells Hibernate Validator that
when validating a <code class="highlighter-rouge">Person</code> the <code class="highlighter-rouge">Address</code> should also be
validated, but only when address is provided (<code class="highlighter-rouge">address</code> is non null).
If we require that a <code class="highlighter-rouge">Person</code> must always have an address we may use
<code class="highlighter-rouge">@NotNull</code> to enforce that rule:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
    <span class="nd">@NotNull</span>
    <span class="nd">@Valid</span>
    <span class="kd">private</span> <span class="n">Address</span> <span class="n">address</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure>

<p>Now when validating person with an invalid address we get:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// ...</span>
<span class="n">Address</span> <span class="n">joeHomeAddress</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Address</span><span class="o">();</span>
<span class="n">joeHomeAddress</span><span class="o">.</span><span class="na">setCity</span><span class="o">(</span><span class="s">"Warsaw"</span><span class="o">);</span>
<span class="n">joeHomeAddress</span><span class="o">.</span><span class="na">setZipCode</span><span class="o">(</span><span class="s">"00-120"</span><span class="o">);</span>
<span class="n">joe</span><span class="o">.</span><span class="na">setAddress</span><span class="o">(</span><span class="n">joeHomeAddress</span><span class="o">);</span>

<span class="n">validator</span><span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="n">joe</span><span class="o">);</span>
<span class="c1">// CONSTRAINT VIOLATIONS:</span>
<span class="c1">// address.street |               may not be empty | is       null</span></code></pre></figure>

<h5 id="validating-collections">Validating collections</h5>

<p>To demonstrate how collection validation works
we will add a list of contacts
to <code class="highlighter-rouge">Person</code> bean:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
    <span class="nd">@Valid</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Contact</span><span class="o">&gt;</span> <span class="n">contacts</span><span class="o">;</span>
    <span class="c1">// getters,setters,...</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Contact</span> <span class="o">{</span> <span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmailContact</span> <span class="kd">extends</span> <span class="n">Contact</span> <span class="o">{</span>
    <span class="nd">@Email</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">email</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">EmailContact</span><span class="o">()</span> <span class="o">{</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="nf">EmailContact</span><span class="o">(</span><span class="n">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getEmail</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">email</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEmail</span><span class="o">(</span><span class="n">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PhoneContact</span> <span class="kd">extends</span> <span class="n">Contact</span> <span class="o">{</span>
    <span class="nd">@Pattern</span><span class="o">(</span><span class="n">regexp</span> <span class="o">=</span> <span class="s">"\\d{3}-\\d{3}-\\d{3}"</span><span class="o">,</span>
             <span class="n">message</span> <span class="o">=</span> <span class="s">"invalid phone number"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">phoneNumber</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">PhoneContact</span><span class="o">()</span> <span class="o">{</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="nf">PhoneContact</span><span class="o">(</span><span class="n">String</span> <span class="n">phoneNumber</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">phoneNumber</span> <span class="o">=</span> <span class="n">phoneNumber</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getPhoneNumber</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">phoneNumber</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPhoneNumber</span><span class="o">(</span><span class="n">String</span> <span class="n">phoneNumber</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">phoneNumber</span> <span class="o">=</span> <span class="n">phoneNumber</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>Again we used <code class="highlighter-rouge">@Valid</code> annotation to tell Hibernate Validator to
validate all non null beans contained in <code class="highlighter-rouge">contacts</code> collection.
Now we may check if all <code class="highlighter-rouge">Person</code> contacts are valid:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">joe</span><span class="o">.</span><span class="na">setContacts</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
    <span class="k">new</span> <span class="nf">EmailContact</span><span class="o">(</span><span class="s">"joe@example.com"</span><span class="o">),</span>
    <span class="k">new</span> <span class="nf">PhoneContact</span><span class="o">(</span><span class="s">"123-123-123"</span><span class="o">),</span>
    <span class="k">new</span> <span class="nf">EmailContact</span><span class="o">(</span><span class="s">"invalid_email"</span><span class="o">),</span>
    <span class="k">new</span> <span class="nf">PhoneContact</span><span class="o">(</span><span class="s">"invali_phone"</span><span class="o">)</span>
<span class="o">));</span>

<span class="n">validator</span><span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="n">joe</span><span class="o">);</span>
<span class="c1">// CONSTRAINT VIOLATIONS:</span>
<span class="c1">// contacts[3].phoneNumber |           invalid phone number  | is invali_phone</span>
<span class="c1">// contacts[2].email       | not a well-formed email address | is invalid_email</span></code></pre></figure>

<p>Unfortunately there is no build-in annotation that would protect
us from collections containing <code class="highlighter-rouge">null</code>s:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">joe</span><span class="o">.</span><span class="na">setContacts</span><span class="o">(</span><span class="n">Collections</span><span class="o">.</span><span class="na">singletonList</span><span class="o">(</span><span class="kc">null</span><span class="o">));</span>
<span class="k">assert</span> <span class="n">validator</span><span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="n">joe</span><span class="o">).</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">;</span></code></pre></figure>

<p>To fix that problem we must write a custom constraint ourselves.</p>

<h5 id="customizing-validation-messages">Customizing validation messages</h5>

<p>The easiest way to customize validation message is to
set it explicitly via 
<code class="highlighter-rouge">message</code> parameter:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Range</span><span class="o">(</span><span class="n">min</span><span class="o">=</span><span class="mi">1</span><span class="o">,</span> <span class="n">max</span><span class="o">=</span><span class="mi">200</span><span class="o">,</span> 
    <span class="n">message</span> <span class="o">=</span> <span class="s">"person age must be between 1 and 200 years"</span><span class="o">)</span>
<span class="kd">private</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span></code></pre></figure>

<p>This approach is inflexible and you should avoid it, instead
try to load validation messages from application resources.
Hibernate Validator by default will load validation messages from
<code class="highlighter-rouge">resources/ValidationMessages.properties</code> file.
We may use this file to either add new validation message or
customize existing:</p>

<figure class="highlight"><pre><code class="language-no-highlight" data-lang="no-highlight"># Override existing message
org.hibernate.validator.constraints.Range.message=${validatedValue} is not in range (min: {min}, max: {max})

# Create new message
invalid_person_age=person age must be between 1 and 200 years </code></pre></figure>

<p>Then we may use are new message:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Range</span><span class="o">(</span><span class="n">min</span><span class="o">=</span><span class="mi">1</span><span class="o">,</span> <span class="n">max</span><span class="o">=</span><span class="mi">200</span><span class="o">,</span> <span class="n">message</span> <span class="o">=</span> <span class="s">"{invalid_person_age}"</span><span class="o">)</span>
<span class="kd">private</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span></code></pre></figure>

<h4 id="extending-hibernate-validator">Extending Hibernate Validator</h4>

<h5 id="constraint-composition">Constraint composition</h5>

<p>Earlier we used the following code to validate phone number:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Pattern</span><span class="o">(</span><span class="n">regexp</span> <span class="o">=</span> <span class="s">"\\d{3}-\\d{3}-\\d{3}"</span><span class="o">,</span>
         <span class="n">message</span> <span class="o">=</span> <span class="s">"invalid phone number"</span><span class="o">)</span>
<span class="kd">private</span> <span class="n">String</span> <span class="n">phoneNumber</span><span class="o">;</span></code></pre></figure>

<p>We certainly don’t want to repeat this annotation with regex expression and
message accross all codebase, that would violate 
<a href="https://en.wikipedia.org/wiki/Don't_repeat_yourself">DRY principle</a>.
On the other hand the following code validated person name:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@NotNull</span>
<span class="nd">@Length</span><span class="o">(</span><span class="n">min</span><span class="o">=</span><span class="mi">1</span><span class="o">)</span>
<span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span></code></pre></figure>

<p>Here we see that to validate name we need two constraints, again
repeating two constraints in various DTO’s is not a receipt for
a good code.</p>

<p>To solve above problems JSR 303 introduces constraint composition.
In short you create a new constraint annotation and put
on it all required constraints, you may also adjust
message, payload and/or groups to which constraint belongs.
For example we may create <code class="highlighter-rouge">ValidPhoneNumber</code> constraint:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Pattern</span><span class="o">(</span><span class="n">regexp</span> <span class="o">=</span> <span class="s">"\\d{3}-\\d{3}-\\d{3}"</span><span class="o">)</span>
<span class="nd">@ReportAsSingleViolation</span>
<span class="nd">@Constraint</span><span class="o">(</span><span class="n">validatedBy</span> <span class="o">=</span> <span class="o">{</span> <span class="o">})</span>
<span class="nd">@Target</span><span class="o">({</span> <span class="n">METHOD</span><span class="o">,</span> <span class="n">FIELD</span><span class="o">,</span> <span class="n">ANNOTATION_TYPE</span> <span class="o">})</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="n">RUNTIME</span><span class="o">)</span>
<span class="nd">@Documented</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="n">ValidPhoneNumber</span> <span class="o">{</span>
    <span class="n">String</span> <span class="nf">message</span><span class="o">()</span> <span class="k">default</span> <span class="s">"phone number should be in format 999-999-999"</span><span class="o">;</span>
    <span class="n">Class</span><span class="o">&lt;?&gt;[]</span> <span class="n">groups</span><span class="o">()</span> <span class="k">default</span> <span class="o">{</span> <span class="o">};</span>
    <span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Payload</span><span class="o">&gt;[]</span> <span class="nf">payload</span><span class="o">()</span> <span class="k">default</span> <span class="o">{</span> <span class="o">};</span>
<span class="o">}</span></code></pre></figure>

<p>And then use it accross our codebase:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PhoneContact</span> <span class="kd">extends</span> <span class="n">Contact</span> <span class="o">{</span>
    <span class="nd">@ValidPhoneNumber</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">phoneNumber</span><span class="o">;</span>
    <span class="c1">//...</span>
<span class="o">}</span></code></pre></figure>

<p>Not only this adheres to DRY princible but our code
is now more readable.</p>

<p>When we put multiple constraints on composed constraint:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@NotNull</span>
<span class="nd">@Length</span><span class="o">(</span><span class="n">min</span><span class="o">=</span><span class="mi">1</span><span class="o">)</span>
<span class="nd">@Target</span><span class="o">({</span> <span class="n">METHOD</span><span class="o">,</span> <span class="n">FIELD</span><span class="o">,</span> <span class="n">ANNOTATION_TYPE</span> <span class="o">})</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="n">RUNTIME</span><span class="o">)</span>
<span class="nd">@Constraint</span><span class="o">(</span><span class="n">validatedBy</span> <span class="o">=</span> <span class="o">{</span> <span class="o">})</span>
<span class="nd">@Documented</span>
<span class="c1">// @ReportAsSingleViolation</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="n">ValidPersonName</span> <span class="o">{</span>
    <span class="n">String</span> <span class="nf">message</span><span class="o">()</span> <span class="k">default</span> <span class="s">"person must have a name"</span><span class="o">;</span>
    <span class="n">Class</span><span class="o">&lt;?&gt;[]</span> <span class="n">groups</span><span class="o">()</span> <span class="k">default</span> <span class="o">{</span> <span class="o">};</span>
    <span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Payload</span><span class="o">&gt;[]</span> <span class="nf">payload</span><span class="o">()</span> <span class="k">default</span> <span class="o">{</span> <span class="o">};</span>
<span class="o">}</span></code></pre></figure>

<p>And then use it on a field:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@ValidPersonName</span>
<span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span></code></pre></figure>

<p>Each of composing constrains will be reported independently:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Person</span> <span class="n">joe</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person</span><span class="o">();</span>
<span class="n">joe</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">""</span><span class="o">);</span>
<span class="c1">//       name | length must be between 1 and 2147483647 | is     </span>

<span class="n">joe</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
<span class="c1">//       name |                may not be null | is       null</span></code></pre></figure>

<p>We may add <code class="highlighter-rouge">@ReportAsSingleViolation</code> annotation to our
composed constrain to report all violations as a single error.
With <code class="highlighter-rouge">@ReportAsSingleViolation</code> we get:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Person</span> <span class="n">joe</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person</span><span class="o">();</span>
<span class="n">joe</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">""</span><span class="o">);</span>
<span class="c1">//       name |        person must have a name | is       </span>
<span class="n">joe</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
<span class="c1">//       name |        person must have a name | is       null</span></code></pre></figure>

<p>Notice that this time message was taken from composed constraint.</p>

<h5 id="using-payloads">Using payloads</h5>

<p>We may use payloads to pass some additional informations
with validation errors. Canonical example of using payloads is
to differentiate between errors and warnings.</p>

<p>First we must define our payload values:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">javax.validation.Payload</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">SEVERITY</span> <span class="o">{</span>
    <span class="kd">interface</span> <span class="nc">WARNING</span> <span class="kd">extends</span> <span class="n">Payload</span> <span class="o">{</span> <span class="o">}</span>
    <span class="kd">interface</span> <span class="nc">ERROR</span> <span class="kd">extends</span> <span class="n">Payload</span> <span class="o">{</span> <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>Then we may use them with constraints:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">io.mc.validationdemo.constraints.SEVERITY.ERROR</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.mc.validationdemo.constraints.SEVERITY.WARNING</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.validator.constraints.NotBlank</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SeverityDTO</span> <span class="o">{</span>
    <span class="nd">@NotBlank</span><span class="o">(</span><span class="n">payload</span> <span class="o">=</span> <span class="n">ERROR</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">important</span><span class="o">;</span>
    
    <span class="nd">@NotBlank</span><span class="o">(</span><span class="n">payload</span> <span class="o">=</span> <span class="n">WARNING</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">unimportant</span><span class="o">;</span>

    <span class="c1">// ...</span>
<span class="o">}</span></code></pre></figure>

<p>Finally we may use them to decide if given <code class="highlighter-rouge">ConstraintViolation</code>
is warning or error:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">isWarning</span><span class="o">(</span><span class="n">ConstraintViolation</span><span class="o">&lt;?&gt;</span> <span class="n">violation</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">boolean</span> <span class="n">isWarning</span> <span class="o">=</span> <span class="n">violation</span><span class="o">.</span><span class="na">getConstraintDescriptor</span><span class="o">()</span>
            <span class="o">.</span><span class="na">getPayload</span><span class="o">()</span>
            <span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">SEVERITY</span><span class="o">.</span><span class="na">WARNING</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">isWarning</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure>

<p>I am certain that you will find some creative usages of payloads
in you application.</p>

<h5 id="creating-new-constraints">Creating new constraints</h5>

<p>To demonstrate how to create a new constraint,
we will create <code class="highlighter-rouge">@NotContain</code> validation rule that
checks that <code class="highlighter-rouge">String</code> doesn’t contains specified value.</p>

<p>We will start by creating annotation (here it is best
to follow example from <a href="https://docs.jboss.org/hibernate/stable/validator/reference/en-US/html_single/#validator-customconstraints-constraintannotation">official documentation</a>):</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Target</span><span class="o">({</span><span class="n">FIELD</span><span class="o">,</span> <span class="n">METHOD</span><span class="o">,</span> <span class="n">ANNOTATION_TYPE</span><span class="o">})</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="n">RUNTIME</span><span class="o">)</span>
<span class="nd">@Documented</span>
<span class="nd">@Constraint</span><span class="o">(</span><span class="n">validatedBy</span> <span class="o">=</span> <span class="n">NotContainValidator</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="n">NotContain</span> <span class="o">{</span>
    <span class="n">String</span> <span class="nf">message</span><span class="o">()</span> <span class="k">default</span> <span class="s">"{validation.NotContain}"</span><span class="o">;</span>
    <span class="n">Class</span><span class="o">&lt;?&gt;[]</span> <span class="n">groups</span><span class="o">()</span> <span class="k">default</span> <span class="o">{</span> <span class="o">};</span>
    <span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Payload</span><span class="o">&gt;[]</span> <span class="nf">payload</span><span class="o">()</span> <span class="k">default</span> <span class="o">{</span> <span class="o">};</span>
    <span class="n">String</span> <span class="nf">value</span><span class="o">();</span>

    <span class="nd">@Target</span><span class="o">({</span> <span class="n">FIELD</span><span class="o">,</span> <span class="n">METHOD</span><span class="o">,</span> <span class="n">ANNOTATION_TYPE</span> <span class="o">})</span>
    <span class="nd">@Retention</span><span class="o">(</span><span class="n">RUNTIME</span><span class="o">)</span>
    <span class="nd">@Documented</span>
    <span class="nd">@interface</span> <span class="n">List</span> <span class="o">{</span>
        <span class="n">NotContain</span><span class="o">[]</span> <span class="nf">value</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>Then we must implement <code class="highlighter-rouge">NotContainValidator</code>:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NotContainValidator</span> 
    <span class="kd">implements</span> <span class="n">ConstraintValidator</span><span class="o">&lt;</span><span class="n">NotContain</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span>
<span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">bannedPhrase</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initialize</span><span class="o">(</span><span class="n">NotContain</span> <span class="n">constraintAnnotation</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">bannedPhrase</span> <span class="o">=</span> <span class="n">constraintAnnotation</span><span class="o">.</span><span class="na">value</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isValid</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">,</span> <span class="n">ConstraintValidatorContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">boolean</span> <span class="n">isValid</span> <span class="o">=</span>
            <span class="n">value</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="o">!</span><span class="n">value</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">bannedPhrase</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">isValid</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>Then we should define our validation message
in <code class="highlighter-rouge">resources/ValidationMessages.properties</code> file, and we are done:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
    <span class="nd">@ValidPersonName</span>
    <span class="nd">@NotContain</span><span class="o">(</span><span class="s">"f**k"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="c1">// ...</span>
<span class="o">}</span>

<span class="n">Person</span> <span class="n">joe</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person</span><span class="o">();</span>
<span class="n">joe</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"f**k"</span><span class="o">);</span>

<span class="n">validator</span><span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="n">joe</span><span class="o">);</span>
<span class="c1">// VIOLATED CONSTRAINTS:</span>
<span class="c1">// name | Property should not contain f**k | is       f**k</span></code></pre></figure>

<h5 id="value-unwrappers">Value unwrappers</h5>

<p>Sometimes we want to validate value that is contained in some other
type. For example we may want to validate a <code class="highlighter-rouge">String</code> contained
in <code class="highlighter-rouge">Optional&lt;String&gt;</code>.
This is possible in Hibernate Validator thanks to value unwrappers.</p>

<p>Hibernate Validator out of the box supports <code class="highlighter-rouge">Optional&lt;T&gt;</code> type, so
for a sake of example we will create our own “wrapper” type:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Box</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">T</span> <span class="n">value</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">T</span> <span class="nf">getValue</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setValue</span><span class="o">(</span><span class="n">T</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>Now we may use our wapper type in DTOs:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UnwrappingDTO</span> <span class="o">{</span>
    <span class="nd">@Length</span><span class="o">(</span><span class="n">min</span><span class="o">=</span><span class="mi">3</span><span class="o">,</span><span class="n">max</span><span class="o">=</span><span class="mi">10</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Box</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">name</span><span class="o">;</span>

    <span class="nd">@Min</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Box</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">age</span><span class="o">;</span>

    <span class="c1">// getters, setters </span>
<span class="o">}</span></code></pre></figure>

<p>If we try to validate <code class="highlighter-rouge">UnwrappingDTO</code> instance we will get
an exception:</p>

<figure class="highlight"><pre><code class="language-no-highlight" data-lang="no-highlight">javax.validation.UnexpectedTypeException: HV000030: 
    No validator could be found for constraint 'Length' 
    validating type 'Box&lt;String&gt;'.</code></pre></figure>

<p>To make validation work again we must create are
own type unwrapper:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BoxUnwrapper</span> <span class="kd">extends</span> <span class="n">ValidatedValueUnwrapper</span><span class="o">&lt;</span><span class="n">Box</span><span class="o">&lt;?&gt;&gt;</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">handleValidatedValue</span><span class="o">(</span><span class="n">Box</span><span class="o">&lt;?&gt;</span> <span class="n">property</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">property</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Type</span> <span class="nf">getValidatedValueType</span><span class="o">(</span><span class="n">Type</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// return generic parameter T of Box&lt;T&gt;</span>
        <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span> <span class="o">=</span> <span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;)</span>
                <span class="o">((</span><span class="n">ParameterizedType</span><span class="o">)</span><span class="n">type</span><span class="o">).</span><span class="na">getActualTypeArguments</span><span class="o">()[</span><span class="mi">0</span><span class="o">];</span>

        <span class="k">return</span> <span class="n">clazz</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>And register it in Hibernate Validatior framework:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Validator</span> <span class="n">validator</span> <span class="o">=</span> <span class="n">Validation</span><span class="o">.</span><span class="na">byProvider</span><span class="o">(</span><span class="n">HibernateValidator</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
        <span class="o">.</span><span class="na">configure</span><span class="o">()</span>
        <span class="o">.</span><span class="na">addValidatedValueHandler</span><span class="o">(</span><span class="k">new</span> <span class="n">BoxUnwrapper</span><span class="o">())</span>
        <span class="o">.</span><span class="na">buildValidatorFactory</span><span class="o">()</span>
        <span class="o">.</span><span class="na">getValidator</span><span class="o">();</span></code></pre></figure>

<p>The last thing that we should do, is to annotate <code class="highlighter-rouge">Box&lt;T&gt;</code> properties with
<code class="highlighter-rouge">@UnwrapValidatedValue</code>:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Length</span><span class="o">(</span><span class="n">min</span><span class="o">=</span><span class="mi">3</span><span class="o">,</span><span class="n">max</span><span class="o">=</span><span class="mi">10</span><span class="o">)</span>
<span class="nd">@UnwrapValidatedValue</span>
<span class="kd">private</span> <span class="n">Box</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">name</span><span class="o">;</span>

<span class="nd">@Min</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
<span class="nd">@UnwrapValidatedValue</span>
<span class="kd">private</span> <span class="n">Box</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">age</span><span class="o">;</span></code></pre></figure>

<p>And now we can validate <code class="highlighter-rouge">Box</code>ed values, yay!</p>

<h5 id="integrating-hibernate-validator-with-spring-di">Integrating Hibernate Validator with Spring DI</h5>

<p>This section shows how to quickly integrate Hibernate Validator
with Spring. This is not the offical way of how you should integrate
with DI, just a quick and dirty solution that you may find helpful.
You have been warned. Also remember that Spring provides it’s
own validation framework, fully complaint with JSR 303 and called
<a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/html/validation.html#validation-beanvalidation">Spring Validation</a>.</p>

<p>First we must create validator factory and register it in Spring
and in Hibernate Validator framework:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringConstrainValidationFactory</span> 
<span class="kd">implements</span> <span class="n">ConstraintValidatorFactory</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">ApplicationContext</span> <span class="n">context</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">ConstraintValidator</span><span class="o">&lt;?,</span> <span class="o">?&gt;&gt;</span> <span class="n">T</span> <span class="nf">getInstance</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">getPackage</span><span class="o">().</span><span class="na">getName</span><span class="o">().</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"javax.validation"</span><span class="o">)</span> <span class="o">||</span>
            <span class="n">key</span><span class="o">.</span><span class="na">getPackage</span><span class="o">().</span><span class="na">getName</span><span class="o">().</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"org.hibernate.validator"</span><span class="o">))</span>
        <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="c1">// create standard validators by calling</span>
                <span class="c1">// default constructor</span>
                <span class="k">return</span> <span class="n">key</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="c1">// Use Spring to create validator bean</span>
        <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">releaseInstance</span><span class="o">(</span><span class="n">ConstraintValidator</span><span class="o">&lt;?,</span> <span class="o">?&gt;</span> <span class="n">instance</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// DO NOTHING</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>And in application configuration we should have:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Configuration</span>
<span class="nd">@ComponentScan</span><span class="o">(</span><span class="s">"your.package.name"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppConfig</span> <span class="o">{</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">Validator</span> <span class="nf">getHibernateValidator</span><span class="o">(</span>
        <span class="n">SpringConstrainValidationFactory</span> <span class="n">factory</span><span class="o">)</span>
    <span class="o">{</span>
       <span class="n">Validator</span> <span class="n">validatorEx</span> <span class="o">=</span> <span class="n">Validation</span><span class="o">.</span><span class="na">byProvider</span><span class="o">(</span><span class="n">HibernateValidator</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                <span class="o">.</span><span class="na">configure</span><span class="o">()</span>
                <span class="o">.</span><span class="na">addValidatedValueHandler</span><span class="o">(</span><span class="k">new</span> <span class="n">BoxUnwrapper</span><span class="o">())</span>
                <span class="c1">// register Spring based validator factory</span>
                <span class="o">.</span><span class="na">constraintValidatorFactory</span><span class="o">(</span><span class="n">factory</span><span class="o">)</span>
                <span class="o">.</span><span class="na">buildValidatorFactory</span><span class="o">()</span>
                <span class="o">.</span><span class="na">getValidator</span><span class="o">();</span>

       <span class="k">return</span> <span class="n">validatorEx</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>Also do not forget to mark validators as <code class="highlighter-rouge">@Component</code>, now we may
use dependency injection inside validators.</p>



        </section>

        <footer class="post-footer">

            <!-- Everything inside the #author tags pulls data from the author -->
            <!-- #author-->
            
                
                    
                        <figure class="author-image">
                            <a class="img" href="/author/mc" style="background-image: url(/assets/images/mc.png)"><span class="hidden">mc's Picture</span></a>
                        </figure>
                    

                    <section class="author">
                        <h4><a href="/author/mc">Marcin Chwedczuk</a></h4>

                        
                            <p> A programmer, a geek, a human</p>
                        
                        <div class="author-meta">
                            <span class="author-location icon-location"> Warsaw, Poland</span>
                            <span class="author-link icon-link"><a href="http://marcinchwedczuk.pl"> http://marcinchwedczuk.pl</a></span>
                        </div>
                    </section>

                    <!-- /author  -->

                    <section class="share">
                        <h4>Share this post</h4>
                        <a class="icon-twitter" href="http://twitter.com/share?text=Hello, Hibernate Validator&amp;url=http://localhost:4000hello-hibernate-validator"
                            onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                            <span class="hidden">Twitter</span>
                        </a>
                        <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000hello-hibernate-validator"
                            onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                            <span class="hidden">Facebook</span>
                        </a>
                        <a class="icon-google-plus" href="https://plus.google.com/share?url=http://localhost:4000hello-hibernate-validator"
                           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                            <span class="hidden">Google+</span>
                        </a>
                    </section>
                
            

            <!-- Add Disqus Comments -->
            
                <div id="disqus_thread"></div>
<script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'marcinchwedczukgithubio'; // required: replace example with your forum shortname
        var disqus_identifier = '/hello-hibernate-validator';
        var disqus_url = 'http://localhost:4000/hello-hibernate-validator';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>

            

        </footer>

    </article>

</main>

<aside class="read-next">

    <!-- [[! next_post ]] -->
    
        <a class="read-next-story " style="background-image: url(/assets/images/zen_cover2.jpg)" href="/zen-and-the-art-of-unit-testing">
            <section class="post">
                <h2>Zen and the Art of Unit Testing</h2>
                <p>In this blog post we will concern ourselves with unit testing of classic 3-layer business...</p>
            </section>
        </a>
    
    <!-- [[! /next_post ]] -->
    <!-- [[! prev_post ]] -->
    
        <a class="read-next-story prev " style="background-image: url(/assets/images/mc_cover9.jpeg)" href="/comparing-with-nullsFirst-and-nullsLast">
            <section class="post">
                <h2>Comparing with nullsFirst and nullsLast</h2>
                <p>Sorting in Java is easy: public class Data { private final String value; public Data(String...</p>
            </section>
        </a>
    
    <!-- [[! /prev_post ]] -->
</aside>

<!-- /post -->


        <!-- The tiny footer at the very bottom -->
        <footer class="site-footer clearfix">
          <section class="copyright"><a href="/">Programming is Magic</a> &copy; 2020</section>
          <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> using <a href="https://github.com/jekyller/jasper">Jasper</a></section>
        </footer>
    </div>
    <!-- highlight.js -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- jQuery needs to come before `` so that jQuery can be used in code injection -->
    <script type="text/javascript" src="//code.jquery.com/jquery-1.12.0.min.js"></script>
    <!-- Ghost outputs important scripts and data with this tag -->
    <!--  -->
    <!-- Add Google Analytics  -->
        <!-- Google Analytics Tracking code -->
     <script>
	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	    ga('create', 'UA-82096342-1', 'auto');
	    ga('send', 'pageview');

     </script>
    <!-- Fitvids makes video embeds responsive and awesome -->
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <!-- The main JavaScript file for Casper -->
    <script type="text/javascript" src="/assets/js/index.js"></script>

</body>
</html>
